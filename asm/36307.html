<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Jet Set Willy: Routine at 36307</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="36288.html">36288</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#36307">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="36564.html">36564</a></span></td>
</tr>
</table>
<div class="description">36307: Move Willy (1)</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="35245.html">35245</a>. This routine deals with Willy if he's jumping or falling.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36307"></a>36307</td>
<td class="instruction">LD A,(34262)</td>
<td class="comment-11" rowspan="1">Pick up the rope status indicator from <a class="link" href="34262.html">34262</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36310"></a>36310</td>
<td class="instruction">DEC A</td>
<td class="comment-11" rowspan="2">Is Willy on a rope?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36311"></a>36311</td>
<td class="instruction">BIT 7,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36313"></a>36313</td>
<td class="instruction">JP Z,<a class="link" href="36564.html">36564</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36316"></a>36316</td>
<td class="instruction">LD A,(34257)</td>
<td class="comment-11" rowspan="1">Pick up the airborne status indicator from <a class="link" href="34257.html">34257</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36319"></a>36319</td>
<td class="instruction">CP 1</td>
<td class="comment-11" rowspan="1">Is Willy jumping?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36321"></a>36321</td>
<td class="instruction">JR NZ,<a class="link" href="36307.html#36406">36406</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="36323"></a>
<div class="comments">
<div class="paragraph">
Willy is currently jumping.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36323"></a>36323</td>
<td class="instruction">LD A,(34261)</td>
<td class="comment-11" rowspan="1">Pick up the jumping animation counter (0-17) from <a class="link" href="34261.html">34261</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36326"></a>36326</td>
<td class="instruction">AND 254</td>
<td class="comment-11" rowspan="1">Discard bit 0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36328"></a>36328</td>
<td class="instruction">SUB 8</td>
<td class="comment-11" rowspan="1">Now -8&lt;=<span class="register">A</span>&lt;=8 (and <span class="register">A</span> is even)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36330"></a>36330</td>
<td class="instruction">LD HL,34255</td>
<td class="comment-11" rowspan="3">Adjust Willy's pixel y-coordinate at <a class="link" href="34255.html">34255</a> depending on where Willy is in the jump</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36333"></a>36333</td>
<td class="instruction">ADD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36334"></a>36334</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36335"></a>36335</td>
<td class="instruction">CP 240</td>
<td class="comment-11" rowspan="1">Is the new value negative (above the top of the screen)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36337"></a>36337</td>
<td class="instruction">JP NC,<a class="link" href="38064.html">38064</a></td>
<td class="comment-11" rowspan="1">If so, move Willy into the room above</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36340"></a>36340</td>
<td class="instruction">CALL <a class="link" href="36307.html#36508">36508</a></td>
<td class="comment-11" rowspan="1">Adjust Willy's attribute buffer location at <a class="link" href="34259.html">34259</a> depending on his pixel y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36343"></a>36343</td>
<td class="instruction">LD A,(32946)</td>
<td class="comment-11" rowspan="1">Pick up the attribute byte of the wall tile for the current room from <a class="link" href="32928.html#32946">32946</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36346"></a>36346</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Is the top-left cell of Willy's sprite overlapping a wall tile?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36347"></a>36347</td>
<td class="instruction">JP Z,<a class="link" href="36307.html#36540">36540</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36350"></a>36350</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the top-right cell occupied by Willy's sprite</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36351"></a>36351</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Is the top-right cell of Willy's sprite overlapping a wall tile?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36352"></a>36352</td>
<td class="instruction">JP Z,<a class="link" href="36307.html#36540">36540</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36355"></a>36355</td>
<td class="instruction">LD A,(34261)</td>
<td class="comment-11" rowspan="3">Increment the jumping animation counter at <a class="link" href="34261.html">34261</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36358"></a>36358</td>
<td class="instruction">INC A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36359"></a>36359</td>
<td class="instruction">LD (34261),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36362"></a>36362</td>
<td class="instruction">SUB 8</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=J-8, where J (1-18) is the new value of the jumping animation counter</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36364"></a>36364</td>
<td class="instruction">JP P,<a class="link" href="36307.html#36369">36369</a></td>
<td class="comment-11" rowspan="1">Jump if J&gt;=8</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36367"></a>36367</td>
<td class="instruction">NEG</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=8-J (1&lt;=J&lt;=7, 1&lt;=<span class="register">A</span>&lt;=7)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36369"></a>36369</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=1+ABS(J-8)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36370"></a>36370</td>
<td class="instruction">RLCA</td>
<td class="comment-11" rowspan="4"><span class="register">D</span>=8*(1+ABS(J-8)); this value determines the pitch of the jumping sound effect (rising as Willy rises, falling as Willy falls)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36371"></a>36371</td>
<td class="instruction">RLCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36372"></a>36372</td>
<td class="instruction">RLCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36373"></a>36373</td>
<td class="instruction">LD D,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36374"></a>36374</td>
<td class="instruction">LD C,32</td>
<td class="comment-11" rowspan="1"><span class="register">C</span>=32; this value determines the duration of the jumping sound effect</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36376"></a>36376</td>
<td class="instruction">LD A,(32990)</td>
<td class="comment-11" rowspan="1">Pick up the border colour for the current room from <a class="link" href="32990.html">32990</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36379"></a>36379</td>
<td class="instruction">OUT (254),A</td>
<td class="comment-11" rowspan="6">Make a jumping sound effect</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36381"></a>36381</td>
<td class="instruction">XOR 24</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36383"></a>36383</td>
<td class="instruction">LD B,D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36384"></a>36384</td>
<td class="instruction">DJNZ <a class="link" href="36307.html#36384">36384</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36386"></a>36386</td>
<td class="instruction">DEC C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36387"></a>36387</td>
<td class="instruction">JR NZ,<a class="link" href="36307.html#36379">36379</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36389"></a>36389</td>
<td class="instruction">LD A,(34261)</td>
<td class="comment-11" rowspan="1">Pick up the jumping animation counter (1-18) from <a class="link" href="34261.html">34261</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36392"></a>36392</td>
<td class="instruction">CP 18</td>
<td class="comment-11" rowspan="1">Has Willy reached the end of the jump?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36394"></a>36394</td>
<td class="instruction">JP Z,<a class="link" href="36307.html#36528">36528</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36397"></a>36397</td>
<td class="instruction">CP 16</td>
<td class="comment-11" rowspan="1">Is the jumping animation counter now 16?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36399"></a>36399</td>
<td class="instruction">JR Z,<a class="link" href="36307.html#36406">36406</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36401"></a>36401</td>
<td class="instruction">CP 13</td>
<td class="comment-11" rowspan="1">Is the jumping animation counter now 13?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36403"></a>36403</td>
<td class="instruction">JP NZ,<a class="link" href="36796.html">36796</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="36406"></a>
<div class="comments">
<div class="paragraph">
If we get here, then Willy is standing on the floor, or he's falling, or his jumping animation counter is 13 (at which point Willy is on his way down and is exactly two cell-heights above where he started the jump) or 16 (at which point Willy is on his way down and is exactly one cell-height above where he started the jump).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36406"></a>36406</td>
<td class="instruction">LD A,(34255)</td>
<td class="comment-11" rowspan="1">Pick up Willy's pixel y-coordinate from <a class="link" href="34255.html">34255</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36409"></a>36409</td>
<td class="instruction">AND 14</td>
<td class="comment-11" rowspan="1">Does Willy's sprite occupy six cells at the moment?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36411"></a>36411</td>
<td class="instruction">JR NZ,<a class="link" href="36307.html#36450">36450</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36413"></a>36413</td>
<td class="instruction">LD HL,(34259)</td>
<td class="comment-11" rowspan="1">Pick up Willy's attribute buffer coordinates from <a class="link" href="34259.html">34259</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36416"></a>36416</td>
<td class="instruction">LD DE,64</td>
<td class="comment-11" rowspan="2">Point <span class="register">HL</span> at the left-hand cell below Willy's sprite</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36419"></a>36419</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36420"></a>36420</td>
<td class="instruction">BIT 1,H</td>
<td class="comment-11" rowspan="1">Is this location below the floor of the current room?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36422"></a>36422</td>
<td class="instruction">JP NZ,<a class="link" href="38098.html">38098</a></td>
<td class="comment-11" rowspan="1">If so, move Willy into the room below</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36425"></a>36425</td>
<td class="instruction">LD A,(32955)</td>
<td class="comment-11" rowspan="1">Pick up the attribute byte of the nasty tile for the current room from <a class="link" href="32928.html#32955">32955</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36428"></a>36428</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Does the left-hand cell below Willy's sprite contain a nasty?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36429"></a>36429</td>
<td class="instruction">JR Z,<a class="link" href="36307.html#36450">36450</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36431"></a>36431</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the right-hand cell below Willy's sprite</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36432"></a>36432</td>
<td class="instruction">LD A,(32955)</td>
<td class="comment-11" rowspan="1">Pick up the attribute byte of the nasty tile for the current room from <a class="link" href="32928.html#32955">32955</a> (again, redundantly)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36435"></a>36435</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Does the right-hand cell below Willy's sprite contain a nasty?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36436"></a>36436</td>
<td class="instruction">JR Z,<a class="link" href="36307.html#36450">36450</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36438"></a>36438</td>
<td class="instruction">LD A,(32928)</td>
<td class="comment-11" rowspan="1">Pick up the attribute byte of the background tile for the current room from <a class="link" href="32928.html">32928</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36441"></a>36441</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Set the zero flag if the right-hand cell below Willy's sprite is empty</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36442"></a>36442</td>
<td class="instruction">DEC HL</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the left-hand cell below Willy's sprite</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36443"></a>36443</td>
<td class="instruction">JP NZ,<a class="link" href="36564.html">36564</a></td>
<td class="comment-11" rowspan="1">Jump if the right-hand cell below Willy's sprite is not empty</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36446"></a>36446</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Is the left-hand cell below Willy's sprite empty?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36447"></a>36447</td>
<td class="instruction">JP NZ,<a class="link" href="36564.html">36564</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36450"></a>36450</td>
<td class="instruction">LD A,(34257)</td>
<td class="comment-11" rowspan="1">Pick up the airborne status indicator from <a class="link" href="34257.html">34257</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36453"></a>36453</td>
<td class="instruction">CP 1</td>
<td class="comment-11" rowspan="1">Is Willy jumping?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36455"></a>36455</td>
<td class="instruction">JP Z,<a class="link" href="36796.html">36796</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="36458"></a>
<div class="comments">
<div class="paragraph">
If we get here, then Willy is either in the process of falling or just about to start falling.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36458"></a>36458</td>
<td class="instruction">LD HL,34256</td>
<td class="comment-11" rowspan="2">Reset bit 1 at <a class="link" href="34256.html">34256</a>: Willy is not moving left or right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36461"></a>36461</td>
<td class="instruction">RES 1,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36463"></a>36463</td>
<td class="instruction">LD A,(34257)</td>
<td class="comment-11" rowspan="1">Pick up the airborne status indicator from <a class="link" href="34257.html">34257</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36466"></a>36466</td>
<td class="instruction">OR A</td>
<td class="comment-11" rowspan="1">Is Willy already falling?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36467"></a>36467</td>
<td class="instruction">JP Z,<a class="link" href="36307.html#36534">36534</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36470"></a>36470</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="1">Increment the airborne status indicator</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36471"></a>36471</td>
<td class="instruction">CP 16</td>
<td class="comment-11" rowspan="1">Is it 16 now?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36473"></a>36473</td>
<td class="instruction">JR NZ,<a class="link" href="36307.html#36477">36477</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36475"></a>36475</td>
<td class="instruction">LD A,12</td>
<td class="comment-11" rowspan="1">Decrease the airborne status indicator from 16 to 12</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36477"></a>36477</td>
<td class="instruction">LD (34257),A</td>
<td class="comment-11" rowspan="1">Update the airborne status indicator at <a class="link" href="34257.html">34257</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36480"></a>36480</td>
<td class="instruction">RLCA</td>
<td class="comment-11" rowspan="5"><span class="register">D</span>=16*<span class="register">A</span>; this value determines the pitch of the falling sound effect</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36481"></a>36481</td>
<td class="instruction">RLCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36482"></a>36482</td>
<td class="instruction">RLCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36483"></a>36483</td>
<td class="instruction">RLCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36484"></a>36484</td>
<td class="instruction">LD D,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36485"></a>36485</td>
<td class="instruction">LD C,32</td>
<td class="comment-11" rowspan="1"><span class="register">C</span>=32; this value determines the duration of the falling sound effect</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36487"></a>36487</td>
<td class="instruction">LD A,(32990)</td>
<td class="comment-11" rowspan="1">Pick up the border colour for the current room from <a class="link" href="32990.html">32990</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36490"></a>36490</td>
<td class="instruction">OUT (254),A</td>
<td class="comment-11" rowspan="6">Make a falling sound effect</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36492"></a>36492</td>
<td class="instruction">XOR 24</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36494"></a>36494</td>
<td class="instruction">LD B,D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36495"></a>36495</td>
<td class="instruction">DJNZ <a class="link" href="36307.html#36495">36495</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36497"></a>36497</td>
<td class="instruction">DEC C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36498"></a>36498</td>
<td class="instruction">JR NZ,<a class="link" href="36307.html#36490">36490</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36500"></a>36500</td>
<td class="instruction">LD A,(34255)</td>
<td class="comment-11" rowspan="3">Add 8 to Willy's pixel y-coordinate at <a class="link" href="34255.html">34255</a>; this moves Willy downwards by 4 pixels</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36503"></a>36503</td>
<td class="instruction">ADD A,8</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36505"></a>36505</td>
<td class="instruction">LD (34255),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="36508"></a>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a class="link" href="37310.html">37310</a> to update Willy's attribute buffer location when he's on a rope.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36508"></a>36508</td>
<td class="instruction">AND 240</td>
<td class="comment-11" rowspan="2"><span class="register">L</span>=16*Y, where Y is Willy's screen y-coordinate (0-14)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36510"></a>36510</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36511"></a>36511</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="1">Clear <span class="register">A</span> and the carry flag</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36512"></a>36512</td>
<td class="instruction">RL L</td>
<td class="comment-11" rowspan="1">Now <span class="register">L</span>=32*(Y-8*INT(Y/8)), and the carry flag is set if Willy is in the lower half of the room (Y&gt;=8)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36514"></a>36514</td>
<td class="instruction">ADC A,92</td>
<td class="comment-11" rowspan="2"><span class="register">H</span>=92 or 93 (MSB of the address of Willy's location in the attribute buffer)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36516"></a>36516</td>
<td class="instruction">LD H,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36517"></a>36517</td>
<td class="instruction">LD A,(34259)</td>
<td class="comment-11" rowspan="2">Pick up Willy's screen x-coordinate (0-30) from bits 0-5 at <a class="link" href="34259.html">34259</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36520"></a>36520</td>
<td class="instruction">AND 31</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36522"></a>36522</td>
<td class="instruction">OR L</td>
<td class="comment-11" rowspan="2">Now <span class="register">L</span> holds the LSB of Willy's attribute buffer address</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36523"></a>36523</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36524"></a>36524</td>
<td class="instruction">LD (34259),HL</td>
<td class="comment-11" rowspan="1">Store Willy's updated attribute buffer location at <a class="link" href="34259.html">34259</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36527"></a>36527</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="36528"></a>
<div class="comments">
<div class="paragraph">
Willy has just finished a jump.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36528"></a>36528</td>
<td class="instruction">LD A,6</td>
<td class="comment-11" rowspan="2">Set the airborne status indicator at <a class="link" href="34257.html">34257</a> to 6: Willy will continue to fall unless he's landed on a wall or floor block</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36530"></a>36530</td>
<td class="instruction">LD (34257),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36533"></a>36533</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="36534"></a>
<div class="comments">
<div class="paragraph">
Willy has just started falling.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36534"></a>36534</td>
<td class="instruction">LD A,2</td>
<td class="comment-11" rowspan="2">Set the airborne status indicator at <a class="link" href="34257.html">34257</a> to 2</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36536"></a>36536</td>
<td class="instruction">LD (34257),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36539"></a>36539</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="36540"></a>
<div class="comments">
<div class="paragraph">
The top-left or top-right cell of Willy's sprite is overlapping a wall tile.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36540"></a>36540</td>
<td class="instruction">LD A,(34255)</td>
<td class="comment-11" rowspan="4">Adjust Willy's pixel y-coordinate at <a class="link" href="34255.html">34255</a> so that the top row of cells of his sprite is just below the wall tile</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36543"></a>36543</td>
<td class="instruction">ADD A,16</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36545"></a>36545</td>
<td class="instruction">AND 240</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36547"></a>36547</td>
<td class="instruction">LD (34255),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36550"></a>36550</td>
<td class="instruction">CALL <a class="link" href="36307.html#36508">36508</a></td>
<td class="comment-11" rowspan="1">Adjust Willy's attribute buffer location at <a class="link" href="34259.html">34259</a> to account for this new pixel y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36553"></a>36553</td>
<td class="instruction">LD A,2</td>
<td class="comment-11" rowspan="2">Set the airborne status indicator at <a class="link" href="34257.html">34257</a> to 2: Willy has started falling</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36555"></a>36555</td>
<td class="instruction">LD (34257),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36558"></a>36558</td>
<td class="instruction">LD HL,34256</td>
<td class="comment-11" rowspan="2">Reset bit 1 at <a class="link" href="34256.html">34256</a>: Willy is not moving left or right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36561"></a>36561</td>
<td class="instruction">RES 1,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36563"></a>36563</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="36288.html">36288</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#36307">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="36564.html">36564</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Jet Set Willy RAM disassembly 20141114</div>
<div class="copyright">&#169; 1984 Software Projects Ltd (Jet Set Willy). &#169; 2014 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.1.1.</div>
</div>
</body>
</html>