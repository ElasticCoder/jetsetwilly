<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Jet Set Willy: Routine at 37056</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="Jet Set Willy" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="37046.html">37046</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#37056">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="37310.html">37310</a></span></td>
</tr>
</table>
<div class="description">37056: Move the rope and guardians in the current room</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="35245.html">35245</a>.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="37056"></a>37056</td>
<td class="instruction">LD IX,33024</td>
<td class="comment-11" rowspan="1">Point <span class="register">IX</span> at the first byte of the entity buffer at <a class="link" href="33024.html">33024</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="37060"></a>
<div class="comments">
<div class="paragraph">
The entity-moving loop begins here.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="37060"></a>37060</td>
<td class="instruction">LD A,(IX+0)</td>
<td class="comment-11" rowspan="1">Pick up the first byte of the current entity definition</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37063"></a>37063</td>
<td class="instruction">CP 255</td>
<td class="comment-11" rowspan="1">Have we reached the end of the entity buffer?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37065"></a>37065</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37066"></a>37066</td>
<td class="instruction">AND 3</td>
<td class="comment-11" rowspan="1">Keep only bits 0 and 1 (which determine the type of entity)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37068"></a>37068</td>
<td class="instruction">JP Z,<a class="link" href="37056.html#37302">37302</a></td>
<td class="comment-11" rowspan="1">Jump to consider the next entity definition if this one is an arrow or is empty</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37071"></a>37071</td>
<td class="instruction">CP 1</td>
<td class="comment-11" rowspan="1">Is this a horizontal guardian?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37073"></a>37073</td>
<td class="instruction">JP Z,<a class="link" href="37056.html#37171">37171</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37076"></a>37076</td>
<td class="instruction">CP 2</td>
<td class="comment-11" rowspan="1">Is this a vertical guardian?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37078"></a>37078</td>
<td class="instruction">JP Z,<a class="link" href="37056.html#37247">37247</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="37081"></a>
<div class="comments">
<div class="paragraph">
We are dealing with a rope.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37081"></a>37081</td>
<td class="instruction">BIT 7,(IX+0)</td>
<td class="comment-11" rowspan="1">Is the rope currently swinging right to left?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37085"></a>37085</td>
<td class="instruction">JR Z,<a class="link" href="37056.html#37119">37119</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="37087"></a>
<div class="comments">
<div class="paragraph">
The rope is swinging left to right.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37087"></a>37087</td>
<td class="instruction">LD A,(IX+1)</td>
<td class="comment-11" rowspan="1">Pick up the animation frame index</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37090"></a>37090</td>
<td class="instruction">BIT 7,A</td>
<td class="comment-11" rowspan="1">Is the rope currently swinging away from the centre?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37092"></a>37092</td>
<td class="instruction">JR Z,<a class="link" href="37056.html#37109">37109</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="37094"></a>
<div class="comments">
<div class="paragraph">
The rope is swinging left to right, towards the centre (132&lt;=<span class="register">A</span>&lt;=182).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37094"></a>37094</td>
<td class="instruction">SUB 2</td>
<td class="comment-11" rowspan="1">Subtract 2 from the animation frame index in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37096"></a>37096</td>
<td class="instruction">CP 148</td>
<td class="comment-11" rowspan="1">Is it still 148 or greater?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37098"></a>37098</td>
<td class="instruction">JR NC,<a class="link" href="37056.html#37149">37149</a></td>
<td class="comment-11" rowspan="1">If so, use it as the next animation frame index</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37100"></a>37100</td>
<td class="instruction">SUB 2</td>
<td class="comment-11" rowspan="1">Subtract 2 from the animation frame index again</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37102"></a>37102</td>
<td class="instruction">CP 128</td>
<td class="comment-11" rowspan="1">Is it 128 now?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37104"></a>37104</td>
<td class="instruction">JR NZ,<a class="link" href="37056.html#37149">37149</a></td>
<td class="comment-11" rowspan="1">If not, use it as the next animation frame index</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37106"></a>37106</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="1">The rope has reached the centre, so the next animation frame index is 0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37107"></a>37107</td>
<td class="instruction">JR <a class="link" href="37056.html#37149">37149</a></td>
<td class="comment-11" rowspan="1">Jump to set it</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="37109"></a>
<div class="comments">
<div class="paragraph">
The rope is swinging left to right, away from the centre (0&lt;=<span class="register">A</span>&lt;=52).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="37109"></a>37109</td>
<td class="instruction">ADD A,2</td>
<td class="comment-11" rowspan="1">Add 2 to the animation frame index in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37111"></a>37111</td>
<td class="instruction">CP 18</td>
<td class="comment-11" rowspan="1">Is it now 18 or greater?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37113"></a>37113</td>
<td class="instruction">JR NC,<a class="link" href="37056.html#37149">37149</a></td>
<td class="comment-11" rowspan="1">If so, use it as the next animation frame index</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37115"></a>37115</td>
<td class="instruction">ADD A,2</td>
<td class="comment-11" rowspan="1">Add 2 to the animation frame index again</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37117"></a>37117</td>
<td class="instruction">JR <a class="link" href="37056.html#37149">37149</a></td>
<td class="comment-11" rowspan="1">Use this value as the next animation frame index</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="37119"></a>
<div class="comments">
<div class="paragraph">
The rope is swinging right to left.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="37119"></a>37119</td>
<td class="instruction">LD A,(IX+1)</td>
<td class="comment-11" rowspan="1">Pick up the animation frame index</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37122"></a>37122</td>
<td class="instruction">BIT 7,A</td>
<td class="comment-11" rowspan="1">Is the rope currently swinging away from the centre?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37124"></a>37124</td>
<td class="instruction">JR NZ,<a class="link" href="37056.html#37141">37141</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="37126"></a>
<div class="comments">
<div class="paragraph">
The rope is swinging right to left, towards the centre (4&lt;=<span class="register">A</span>&lt;=54).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37126"></a>37126</td>
<td class="instruction">SUB 2</td>
<td class="comment-11" rowspan="1">Subtract 2 from the animation frame index in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37128"></a>37128</td>
<td class="instruction">CP 20</td>
<td class="comment-11" rowspan="1">Is it still 20 or greater?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37130"></a>37130</td>
<td class="instruction">JR NC,<a class="link" href="37056.html#37149">37149</a></td>
<td class="comment-11" rowspan="1">If so, use it as the next animation frame index</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37132"></a>37132</td>
<td class="instruction">SUB 2</td>
<td class="comment-11" rowspan="1">Subtract 2 from the animation frame index again</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37134"></a>37134</td>
<td class="instruction">OR A</td>
<td class="comment-11" rowspan="1">Is it 0 now?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37135"></a>37135</td>
<td class="instruction">JR NZ,<a class="link" href="37056.html#37149">37149</a></td>
<td class="comment-11" rowspan="1">If not, use it as the next animation frame index</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37137"></a>37137</td>
<td class="instruction">LD A,128</td>
<td class="comment-11" rowspan="1">The rope has reached the centre, so the next animation frame index is 128</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37139"></a>37139</td>
<td class="instruction">JR <a class="link" href="37056.html#37149">37149</a></td>
<td class="comment-11" rowspan="1">Jump to set it</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="37141"></a>
<div class="comments">
<div class="paragraph">
The rope is swinging right to left, away from the centre (128&lt;=<span class="register">A</span>&lt;=180).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="37141"></a>37141</td>
<td class="instruction">ADD A,2</td>
<td class="comment-11" rowspan="1">Add 2 to the animation frame index in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37143"></a>37143</td>
<td class="instruction">CP 146</td>
<td class="comment-11" rowspan="1">Is it now 146 or greater?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37145"></a>37145</td>
<td class="instruction">JR NC,<a class="link" href="37056.html#37149">37149</a></td>
<td class="comment-11" rowspan="1">If so, use it as the next animation frame index</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37147"></a>37147</td>
<td class="instruction">ADD A,2</td>
<td class="comment-11" rowspan="1">Add 2 to the animation frame index again</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="37149"></a>
<div class="comments">
<div class="paragraph">
Now <span class="register">A</span> holds the rope's next animation frame index.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="37149"></a>37149</td>
<td class="instruction">LD (IX+1),A</td>
<td class="comment-11" rowspan="1">Update the animation frame index</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37152"></a>37152</td>
<td class="instruction">AND 127</td>
<td class="comment-11" rowspan="1">Reset bit 7</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37154"></a>37154</td>
<td class="instruction">CP (IX+7)</td>
<td class="comment-11" rowspan="1">Does <span class="register">A</span> match the eighth byte of the entity definition (54)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37157"></a>37157</td>
<td class="instruction">JP NZ,<a class="link" href="37056.html#37302">37302</a></td>
<td class="comment-11" rowspan="1">If not, jump to consider the next entity definition</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37160"></a>37160</td>
<td class="instruction">LD A,(IX+0)</td>
<td class="comment-11" rowspan="3">Flip bit 7 of the first byte of the entity definition: the rope has just changed direction and will now swing back towards the centre</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37163"></a>37163</td>
<td class="instruction">XOR 128</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37165"></a>37165</td>
<td class="instruction">LD (IX+0),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37168"></a>37168</td>
<td class="instruction">JP <a class="link" href="37056.html#37302">37302</a></td>
<td class="comment-11" rowspan="1">Jump to consider the next entity definition</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="37171"></a>
<div class="comments">
<div class="paragraph">
We are dealing with a horizontal guardian.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="37171"></a>37171</td>
<td class="instruction">BIT 7,(IX+0)</td>
<td class="comment-11" rowspan="1">Is the guardian currently moving left to right?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37175"></a>37175</td>
<td class="instruction">JR NZ,<a class="link" href="37056.html#37212">37212</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="37177"></a>
<div class="comments">
<div class="paragraph">
This guardian is moving right to left.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37177"></a>37177</td>
<td class="instruction">LD A,(IX+0)</td>
<td class="comment-11" rowspan="4">Update the guardian's animation frame (in bits 5 and 6 of the first byte of the entity definition)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37180"></a>37180</td>
<td class="instruction">SUB 32</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37182"></a>37182</td>
<td class="instruction">AND 127</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37184"></a>37184</td>
<td class="instruction">LD (IX+0),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37187"></a>37187</td>
<td class="instruction">CP 96</td>
<td class="comment-11" rowspan="1">Is it time to update the x-coordinate of the guardian sprite?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37189"></a>37189</td>
<td class="instruction">JR C,<a class="link" href="37056.html#37302">37302</a></td>
<td class="comment-11" rowspan="1">If not, jump to consider the next entity definition</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37191"></a>37191</td>
<td class="instruction">LD A,(IX+2)</td>
<td class="comment-11" rowspan="2">Pick up the sprite's current screen x-coordinate (0-31)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37194"></a>37194</td>
<td class="instruction">AND 31</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37196"></a>37196</td>
<td class="instruction">CP (IX+6)</td>
<td class="comment-11" rowspan="1">Has the guardian reached the leftmost point of its path?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37199"></a>37199</td>
<td class="instruction">JR Z,<a class="link" href="37056.html#37206">37206</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37201"></a>37201</td>
<td class="instruction">DEC (IX+2)</td>
<td class="comment-11" rowspan="1">Decrement the sprite's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37204"></a>37204</td>
<td class="instruction">JR <a class="link" href="37056.html#37302">37302</a></td>
<td class="comment-11" rowspan="1">Jump to consider the next entity definition</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="37206"></a>37206</td>
<td class="instruction">LD (IX+0),129</td>
<td class="comment-11" rowspan="1">The guardian will now start moving left to right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37210"></a>37210</td>
<td class="instruction">JR <a class="link" href="37056.html#37302">37302</a></td>
<td class="comment-11" rowspan="1">Jump to consider the next entity definition</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="37212"></a>
<div class="comments">
<div class="paragraph">
This guardian is moving left to right.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="37212"></a>37212</td>
<td class="instruction">LD A,(IX+0)</td>
<td class="comment-11" rowspan="4">Update the guardian's animation frame (in bits 5 and 6 of the first byte of the entity definition)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37215"></a>37215</td>
<td class="instruction">ADD A,32</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37217"></a>37217</td>
<td class="instruction">OR 128</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37219"></a>37219</td>
<td class="instruction">LD (IX+0),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37222"></a>37222</td>
<td class="instruction">CP 160</td>
<td class="comment-11" rowspan="1">Is it time to update the x-coordinate of the guardian sprite?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37224"></a>37224</td>
<td class="instruction">JR NC,<a class="link" href="37056.html#37302">37302</a></td>
<td class="comment-11" rowspan="1">If not, jump to consider the next entity definition</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37226"></a>37226</td>
<td class="instruction">LD A,(IX+2)</td>
<td class="comment-11" rowspan="2">Pick up the sprite's current screen x-coordinate (0-31)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37229"></a>37229</td>
<td class="instruction">AND 31</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37231"></a>37231</td>
<td class="instruction">CP (IX+7)</td>
<td class="comment-11" rowspan="1">Has the guardian reached the rightmost point of its path?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37234"></a>37234</td>
<td class="instruction">JR Z,<a class="link" href="37056.html#37241">37241</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37236"></a>37236</td>
<td class="instruction">INC (IX+2)</td>
<td class="comment-11" rowspan="1">Increment the sprite's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37239"></a>37239</td>
<td class="instruction">JR <a class="link" href="37056.html#37302">37302</a></td>
<td class="comment-11" rowspan="1">Jump to consider the next entity definition</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="37241"></a>37241</td>
<td class="instruction">LD (IX+0),97</td>
<td class="comment-11" rowspan="1">The guardian will now start moving right to left</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37245"></a>37245</td>
<td class="instruction">JR <a class="link" href="37056.html#37302">37302</a></td>
<td class="comment-11" rowspan="1">Jump to consider the next entity definition</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="37247"></a>
<div class="comments">
<div class="paragraph">
We are dealing with a vertical guardian.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="37247"></a>37247</td>
<td class="instruction">LD A,(IX+0)</td>
<td class="comment-11" rowspan="3">Flip bit 3 of the first byte of the entity definition (if bit 4 is set, the guardian's animation frame is updated on every pass through this routine; otherwise, it is updated on every second pass when bit 3 is set)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37250"></a>37250</td>
<td class="instruction">XOR 8</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37252"></a>37252</td>
<td class="instruction">LD (IX+0),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37255"></a>37255</td>
<td class="instruction">AND 24</td>
<td class="comment-11" rowspan="1">Are bits 3 and 4 both reset now?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37257"></a>37257</td>
<td class="instruction">JR Z,<a class="link" href="37056.html#37267">37267</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37259"></a>37259</td>
<td class="instruction">LD A,(IX+0)</td>
<td class="comment-11" rowspan="3">Update the guardian's animation frame (in bits 5 and 6 of the first byte of the entity definition)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37262"></a>37262</td>
<td class="instruction">ADD A,32</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37264"></a>37264</td>
<td class="instruction">LD (IX+0),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="37267"></a>37267</td>
<td class="instruction">LD A,(IX+3)</td>
<td class="comment-11" rowspan="3">Update the guardian's y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37270"></a>37270</td>
<td class="instruction">ADD A,(IX+4)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37273"></a>37273</td>
<td class="instruction">LD (IX+3),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37276"></a>37276</td>
<td class="instruction">CP (IX+7)</td>
<td class="comment-11" rowspan="1">Has the guardian reached the lowest point of its path (maximum y-coordinate)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37279"></a>37279</td>
<td class="instruction">JR NC,<a class="link" href="37056.html#37294">37294</a></td>
<td class="comment-11" rowspan="1">If so, jump to change its direction of movement</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37281"></a>37281</td>
<td class="instruction">CP (IX+6)</td>
<td class="comment-11" rowspan="1">Compare the new y-coordinate with the minimum value (the highest point of its path)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37284"></a>37284</td>
<td class="instruction">JR Z,<a class="link" href="37056.html#37288">37288</a></td>
<td class="comment-11" rowspan="1">If they match, jump to change the guardian's direction of movement</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37286"></a>37286</td>
<td class="instruction">JR NC,<a class="link" href="37056.html#37302">37302</a></td>
<td class="comment-11" rowspan="1">If the new y-coordinate is above the minimum value, jump to consider the next entity definition</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="37288"></a>37288</td>
<td class="instruction">LD A,(IX+6)</td>
<td class="comment-11" rowspan="2">Make sure that the guardian's y-coordinate is set to its minimum value</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37291"></a>37291</td>
<td class="instruction">LD (IX+3),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="37294"></a>37294</td>
<td class="instruction">LD A,(IX+4)</td>
<td class="comment-11" rowspan="3">Negate the y-coordinate increment; this changes the guardian's direction of movement</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37297"></a>37297</td>
<td class="instruction">NEG</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37299"></a>37299</td>
<td class="instruction">LD (IX+4),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="37302"></a>
<div class="comments">
<div class="paragraph">
The current entity definition has been dealt with. Time for the next one.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="37302"></a>37302</td>
<td class="instruction">LD DE,8</td>
<td class="comment-11" rowspan="2">Point <span class="register">IX</span> at the first byte of the next entity definition</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37305"></a>37305</td>
<td class="instruction">ADD IX,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37307"></a>37307</td>
<td class="instruction">JP <a class="link" href="37056.html#37060">37060</a></td>
<td class="comment-11" rowspan="1">Jump back to deal with it</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="37046.html">37046</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#37056">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="37310.html">37310</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Jet Set Willy RAM disassembly 20150328</div>
<div class="copyright">&#169; 1984 Software Projects Ltd (Jet Set Willy). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.3.</div>
</div>
</body>
</html>