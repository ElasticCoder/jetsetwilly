<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Jet Set Willy: Routine at 34499</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="34463.html">34463</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#34499">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="34620.html">34620</a></span></td>
</tr>
</table>
<div class="description">34499: Display the code entry screen</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="34463.html">34463</a>. Displays the code entry screen and waits for a code to be entered. Returns with the zero flag set if the code entered is correct.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">IX</td>
<td class="register-desc">Address of the message to print (<a class="link" href="34187.html">34187</a> or <a class="link" href="34219.html">34219</a>)</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="34499"></a>34499</td>
<td class="instruction">LD DE,18432</td>
<td class="comment-11" rowspan="3">Print the message pointed to by <span class="register">IX</span> at (8,0)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34502"></a>34502</td>
<td class="instruction">LD C,32</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34504"></a>34504</td>
<td class="instruction">CALL <a class="link" href="38528.html">38528</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34507"></a>34507</td>
<td class="instruction">LD HL,18498</td>
<td class="comment-11" rowspan="4">Print the graphic for the '1' key at (10,2)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34510"></a>34510</td>
<td class="instruction">LD DE,39680</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34513"></a>34513</td>
<td class="instruction">LD C,0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34515"></a>34515</td>
<td class="instruction">CALL <a class="link" href="37974.html">37974</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34518"></a>34518</td>
<td class="instruction">LD HL,18501</td>
<td class="comment-11" rowspan="2">Print the graphic for the '2' key at (10,5)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34521"></a>34521</td>
<td class="instruction">CALL <a class="link" href="37974.html">37974</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34524"></a>34524</td>
<td class="instruction">LD HL,18504</td>
<td class="comment-11" rowspan="2">Print the graphic for the '3' key at (10,8)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34527"></a>34527</td>
<td class="instruction">CALL <a class="link" href="37974.html">37974</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34530"></a>34530</td>
<td class="instruction">LD HL,18507</td>
<td class="comment-11" rowspan="2">Print the graphic for the '4' key at (10,11)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34533"></a>34533</td>
<td class="instruction">CALL <a class="link" href="37974.html">37974</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34536"></a>34536</td>
<td class="instruction">LD HL,39808</td>
<td class="comment-11" rowspan="4">Copy the 128 attribute bytes from <a class="link" href="39808.html">39808</a> to the screen (lines 8, 9, 10 and 11)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34539"></a>34539</td>
<td class="instruction">LD DE,22784</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34542"></a>34542</td>
<td class="instruction">LD BC,128</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34545"></a>34545</td>
<td class="instruction">LDIR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34547"></a>34547</td>
<td class="instruction">LD A,(23672)</td>
<td class="comment-11" rowspan="1">Collect the LSB of the system variable FRAMES</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34550"></a>34550</td>
<td class="instruction">ADD A,37</td>
<td class="comment-11" rowspan="2">Add 37 to this value and replace it; this ensures that the value collected on the second pass through this routine is different from the value collected on the first pass</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34552"></a>34552</td>
<td class="instruction">LD (23672),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34555"></a>34555</td>
<td class="instruction">CP 179</td>
<td class="comment-11" rowspan="1">Is the value between 0 and 178?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34557"></a>34557</td>
<td class="instruction">JR C,<a class="link" href="34499.html#34561">34561</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34559"></a>34559</td>
<td class="instruction">SUB 180</td>
<td class="comment-11" rowspan="1">Otherwise subtract 180; note that if the original value of the LSB of the system variable FRAMES was 142, this leaves <span class="register">A</span> holding 255, which is a <a class="link" href="../reference/bugs.html#invalidGridLocation">bug</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="34561"></a>34561</td>
<td class="instruction">LD L,A</td>
<td class="comment-11" rowspan="1">Now <span class="register">L</span> holds either 255 or some number between 0 and 178</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34562"></a>34562</td>
<td class="instruction">LD H,158</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at one of the entries in the table at <a class="link" href="40448.html">40448</a> (or at 40703 if <span class="register">L</span>=255)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34564"></a>34564</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Pick up the table entry</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34565"></a>34565</td>
<td class="instruction">ADD A,L</td>
<td class="comment-11" rowspan="1">Add <span class="register">L</span> to obtain the actual code</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34566"></a>34566</td>
<td class="instruction">LD (34276),A</td>
<td class="comment-11" rowspan="1">Store the code at <a class="link" href="34276.html">34276</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34569"></a>34569</td>
<td class="instruction">LD C,L</td>
<td class="comment-11" rowspan="1">Copy the code index to <span class="register">C</span>; this will be used to compute the grid location</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34570"></a>34570</td>
<td class="instruction">LD E,47</td>
<td class="comment-11" rowspan="8">Calculate the ASCII code of the grid location number (0-9) in <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="34572"></a>34572</td>
<td class="instruction">INC E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34573"></a>34573</td>
<td class="instruction">LD A,C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34574"></a>34574</td>
<td class="instruction">CP 18</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34576"></a>34576</td>
<td class="instruction">JR C,<a class="link" href="34499.html#34583">34583</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34578"></a>34578</td>
<td class="instruction">SUB 18</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34580"></a>34580</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34581"></a>34581</td>
<td class="instruction">JR <a class="link" href="34499.html#34572">34572</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="34583"></a>34583</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="3">Print the grid location number at (8,30)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34584"></a>34584</td>
<td class="instruction">LD DE,18462</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34587"></a>34587</td>
<td class="instruction">CALL <a class="link" href="38545.html">38545</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34590"></a>34590</td>
<td class="instruction">LD A,C</td>
<td class="comment-11" rowspan="2">Calculate the ASCII code of the grid location letter (A-R) in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34591"></a>34591</td>
<td class="instruction">ADD A,65</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34593"></a>34593</td>
<td class="instruction">LD DE,18461</td>
<td class="comment-11" rowspan="2">Print the grid location letter at (8,29)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34596"></a>34596</td>
<td class="instruction">CALL <a class="link" href="38545.html">38545</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="34599"></a>
<div class="comments">
<div class="paragraph">
Here we enter a loop that prints a 2x2 coloured block at (10,16), (10,19), (10,22) or (10,25) whenever '1', '2', '3' or '4' is pressed, or returns to the calling routine at <a class="link" href="34463.html">34463</a> if ENTER is pressed.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="34599"></a>34599</td>
<td class="instruction">LD IX,22864</td>
<td class="comment-11" rowspan="1">Point <span class="register">IX</span> at the attribute file location of the first coloured block at (10,16)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="34603"></a>34603</td>
<td class="instruction">CALL <a class="link" href="34620.html">34620</a></td>
<td class="comment-11" rowspan="1">Print a coloured block when '1', '2', '3' or '4' is pressed, or return to <a class="link" href="34463.html">34463</a> if ENTER is pressed</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34606"></a>34606</td>
<td class="instruction">INC IX</td>
<td class="comment-11" rowspan="3">Move <span class="register">IX</span> along to the location of the next coloured block</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34608"></a>34608</td>
<td class="instruction">INC IX</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34610"></a>34610</td>
<td class="instruction">INC IX</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34612"></a>34612</td>
<td class="instruction">LD A,IXl</td>
<td class="comment-11" rowspan="2">Have we just printed the fourth coloured block at (10,25)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34614"></a>34614</td>
<td class="instruction">CP 92</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34616"></a>34616</td>
<td class="instruction">JR NZ,<a class="link" href="34499.html#34603">34603</a></td>
<td class="comment-11" rowspan="1">If not, jump back to print the next one</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34618"></a>34618</td>
<td class="instruction">JR <a class="link" href="34499.html#34599">34599</a></td>
<td class="comment-11" rowspan="1">Otherwise rewind <span class="register">IX</span> to the location of the first coloured block</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="34463.html">34463</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#34499">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="34620.html">34620</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Jet Set Willy RAM disassembly 20141114</div>
<div class="copyright">&#169; 1984 Software Projects Ltd (Jet Set Willy). &#169; 2014 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.1.1.</div>
</div>
</body>
</html>