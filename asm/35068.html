<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Jet Set Willy: Routine at 35068</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="Jet Set Willy" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="34762.html">34762</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#35068">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="35211.html">35211</a></span></td>
</tr>
</table>
<div class="description">35068: Start the game</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="34762.html">34762</a>.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="35068"></a>35068</td>
<td class="instruction">LD HL,34181</td>
<td class="comment-11" rowspan="4">Initialise the time by copying the text at <a class="link" href="34181.html">34181</a> (" 7:00a") to <a class="link" href="34175.html">34175</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35071"></a>35071</td>
<td class="instruction">LD DE,34175</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35074"></a>35074</td>
<td class="instruction">LD BC,6</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35077"></a>35077</td>
<td class="instruction">LDIR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35079"></a>35079</td>
<td class="instruction">LD HL,39424</td>
<td class="comment-11" rowspan="4">Copy the attribute bytes from <a class="link" href="39424.html">39424</a> to the bottom third of the screen</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35082"></a>35082</td>
<td class="instruction">LD DE,23040</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35085"></a>35085</td>
<td class="instruction">LD BC,256</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35088"></a>35088</td>
<td class="instruction">LDIR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="35090"></a>
<div class="comments">
<div class="paragraph">
This entry point is used by the routines at <a class="link" href="35591.html">35591</a> (to teleport into a room), <a class="link" href="35841.html">35841</a> (to reinitialise the room after Willy has lost a life), <a class="link" href="38026.html">38026</a> (when Willy has entered the room from the right), <a class="link" href="38046.html">38046</a> (when Willy has entered the room from the left), <a class="link" href="38064.html">38064</a> (when Willy has entered the room from below) and <a class="link" href="38098.html">38098</a> (when Willy has entered the room from above).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="35090"></a>35090</td>
<td class="instruction">LD A,(33824)</td>
<td class="comment-11" rowspan="1">Pick up the current room number from <a class="link" href="33824.html">33824</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35093"></a>35093</td>
<td class="instruction">OR 192</td>
<td class="comment-11" rowspan="3">Point <span class="register">HL</span> at the first byte of the room definition</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35095"></a>35095</td>
<td class="instruction">LD H,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35096"></a>35096</td>
<td class="instruction">LD L,0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35098"></a>35098</td>
<td class="instruction">LD DE,32768</td>
<td class="comment-11" rowspan="3">Copy the room definition into the game status buffer at <a class="link" href="../buffers/gbuffer.html#32768">32768</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35101"></a>35101</td>
<td class="instruction">LD BC,256</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35104"></a>35104</td>
<td class="instruction">LDIR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35106"></a>35106</td>
<td class="instruction">LD IX,33008</td>
<td class="comment-11" rowspan="1">Point <span class="register">IX</span> at the first byte of the first entity specification for the current room at <a class="link" href="33008.html">33008</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35110"></a>35110</td>
<td class="instruction">LD DE,33024</td>
<td class="comment-11" rowspan="1">Point <span class="register">DE</span> at the first byte of the entity buffer at <a class="link" href="33024.html">33024</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35113"></a>35113</td>
<td class="instruction">LD A,8</td>
<td class="comment-11" rowspan="1">There are at most eight entities in a room</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="35115"></a>35115</td>
<td class="instruction">LD L,(IX+0)</td>
<td class="comment-11" rowspan="1">Pick up the first byte of the entity specification</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35118"></a>35118</td>
<td class="instruction">RES 7,L</td>
<td class="comment-11" rowspan="5">Point <span class="register">HL</span> at the corresponding entry in the table of entity definitions at <a class="link" href="40960.html">40960</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35120"></a>35120</td>
<td class="instruction">LD H,20</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35122"></a>35122</td>
<td class="instruction">ADD HL,HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35123"></a>35123</td>
<td class="instruction">ADD HL,HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35124"></a>35124</td>
<td class="instruction">ADD HL,HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35125"></a>35125</td>
<td class="instruction">LD BC,2</td>
<td class="comment-11" rowspan="2">Copy the first two bytes of the entity definition into the entity buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35128"></a>35128</td>
<td class="instruction">LDIR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35130"></a>35130</td>
<td class="instruction">LD C,(IX+1)</td>
<td class="comment-11" rowspan="2">Copy the second byte of the entity specification into the third byte of the entity definition</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35133"></a>35133</td>
<td class="instruction">LD (HL),C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35134"></a>35134</td>
<td class="instruction">LD BC,6</td>
<td class="comment-11" rowspan="2">Copy the remaining six bytes of the entity definition into the entity buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35137"></a>35137</td>
<td class="instruction">LDIR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35139"></a>35139</td>
<td class="instruction">INC IX</td>
<td class="comment-11" rowspan="2">Point <span class="register">IX</span> at the first byte of the next entity specification</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35141"></a>35141</td>
<td class="instruction">INC IX</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35143"></a>35143</td>
<td class="instruction">DEC A</td>
<td class="comment-11" rowspan="1">Have we copied all eight entity definitions into the entity buffer yet?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35144"></a>35144</td>
<td class="instruction">JR NZ,<a class="link" href="35068.html#35115">35115</a></td>
<td class="comment-11" rowspan="1">If not, jump back to copy the next one</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35146"></a>35146</td>
<td class="instruction">LD HL,34255</td>
<td class="comment-11" rowspan="4">Copy the seven bytes that define Willy's state (position, animation frame etc.) on entry to this room from <a class="link" href="../buffers/gbuffer.html#34255">34255-34261</a> to <a class="link" href="34263.html">34263</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35149"></a>35149</td>
<td class="instruction">LD DE,34263</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35152"></a>35152</td>
<td class="instruction">LD BC,7</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35155"></a>35155</td>
<td class="instruction">LDIR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35157"></a>35157</td>
<td class="instruction">CALL <a class="link" href="36147.html">36147</a></td>
<td class="comment-11" rowspan="1">Draw the current room to the screen buffer at <a class="link" href="28672.html">28672</a> and the attribute buffer at <a class="link" href="24064.html">24064</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35160"></a>35160</td>
<td class="instruction">LD HL,20480</td>
<td class="comment-11" rowspan="5">Clear the bottom third of the display file</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35163"></a>35163</td>
<td class="instruction">LD DE,20481</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35166"></a>35166</td>
<td class="instruction">LD BC,2047</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35169"></a>35169</td>
<td class="instruction">LD (HL),0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35171"></a>35171</td>
<td class="instruction">LDIR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35173"></a>35173</td>
<td class="instruction">LD IX,32896</td>
<td class="comment-11" rowspan="4">Print the room name (see <a class="link" href="32896.html">32896</a>) at (16,0)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35177"></a>35177</td>
<td class="instruction">LD C,32</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35179"></a>35179</td>
<td class="instruction">LD DE,20480</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35182"></a>35182</td>
<td class="instruction">CALL <a class="link" href="38528.html">38528</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35185"></a>35185</td>
<td class="instruction">LD IX,34132</td>
<td class="comment-11" rowspan="4">Print "Items collected 000 Time 00:00 m" (see <a class="link" href="34132.html">34132</a>) at (19,0)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35189"></a>35189</td>
<td class="instruction">LD DE,20576</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35192"></a>35192</td>
<td class="instruction">LD C,32</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35194"></a>35194</td>
<td class="instruction">CALL <a class="link" href="38528.html">38528</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35197"></a>35197</td>
<td class="instruction">LD A,(32990)</td>
<td class="comment-11" rowspan="1">Pick up the border colour for the current room from <a class="link" href="32990.html">32990</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35200"></a>35200</td>
<td class="instruction">LD C,254</td>
<td class="comment-11" rowspan="2">Set the border colour</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35202"></a>35202</td>
<td class="instruction">OUT (C),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35204"></a>35204</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="2">Initialise the rope status indicator at <a class="link" href="34262.html">34262</a> to 0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35205"></a>35205</td>
<td class="instruction">LD (34262),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35208"></a>35208</td>
<td class="instruction">JP <a class="link" href="35245.html">35245</a></td>
<td class="comment-11" rowspan="1">Enter the main loop</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="34762.html">34762</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#35068">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="35211.html">35211</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Jet Set Willy RAM disassembly 20150328</div>
<div class="copyright">&#169; 1984 Software Projects Ltd (Jet Set Willy). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.3.</div>
</div>
</body>
</html>