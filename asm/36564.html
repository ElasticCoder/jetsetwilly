<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Jet Set Willy: Routine at 36564</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="36307.html">36307</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#36564">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="36796.html">36796</a></span></td>
</tr>
</table>
<div class="description">36564: Move Willy (2)</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="36307.html">36307</a>. This routine checks the keyboard and joystick.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Attribute buffer address of the left-hand cell below Willy's sprite (if Willy is not on a rope)</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36564"></a>36564</td>
<td class="instruction">LD E,255</td>
<td class="comment-11" rowspan="1">Initialise <span class="register">E</span> to 255 (all bits set); it will be used to hold keyboard and joystick readings</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36566"></a>36566</td>
<td class="instruction">LD A,(34262)</td>
<td class="comment-11" rowspan="1">Pick up the rope status indicator from <a class="link" href="34262.html">34262</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36569"></a>36569</td>
<td class="instruction">DEC A</td>
<td class="comment-11" rowspan="2">Is Willy on a rope?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36570"></a>36570</td>
<td class="instruction">BIT 7,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36572"></a>36572</td>
<td class="instruction">JR Z,<a class="link" href="36564.html#36602">36602</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36574"></a>36574</td>
<td class="instruction">LD A,(34257)</td>
<td class="comment-11" rowspan="1">Pick up the airborne status indicator from <a class="link" href="34257.html">34257</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36577"></a>36577</td>
<td class="instruction">CP 12</td>
<td class="comment-11" rowspan="1">Has Willy just landed after falling from too great a height?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36579"></a>36579</td>
<td class="instruction">JP NC,<a class="link" href="37046.html#37047">37047</a></td>
<td class="comment-11" rowspan="1">If so, kill him</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36582"></a>36582</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="2">Reset the airborne status indicator at <a class="link" href="34257.html">34257</a> (Willy has landed safely)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36583"></a>36583</td>
<td class="instruction">LD (34257),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36586"></a>36586</td>
<td class="instruction">LD A,(32973)</td>
<td class="comment-11" rowspan="1">Pick up the attribute byte of the conveyor tile for the current room from <a class="link" href="32928.html#32973">32973</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36589"></a>36589</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Does the attribute byte of the left-hand cell below Willy's sprite match that of the conveyor tile?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36590"></a>36590</td>
<td class="instruction">JR Z,<a class="link" href="36564.html#36596">36596</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36592"></a>36592</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the right-hand cell below Willy's sprite</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36593"></a>36593</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Does the attribute byte of the right-hand cell below Willy's sprite match that of the conveyor tile?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36594"></a>36594</td>
<td class="instruction">JR NZ,<a class="link" href="36564.html#36602">36602</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36596"></a>36596</td>
<td class="instruction">LD A,(32982)</td>
<td class="comment-11" rowspan="1">Pick up the direction byte of the conveyor definition from <a class="link" href="32982.html">32982</a> (0=left, 1=right)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36599"></a>36599</td>
<td class="instruction">SUB 3</td>
<td class="comment-11" rowspan="2">Now <span class="register">E</span>=253 (bit 1 reset) if the conveyor is moving left, or 254 (bit 0 reset) if it's moving right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36601"></a>36601</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36602"></a>36602</td>
<td class="instruction">LD BC,57342</td>
<td class="comment-11" rowspan="2">Read keys P-O-U-I-Y (right, left, right, left, right) into bits 0-4 of <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36605"></a>36605</td>
<td class="instruction">IN A,(C)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36607"></a>36607</td>
<td class="instruction">AND 31</td>
<td class="comment-11" rowspan="2">Set bit 5 and reset bits 6 and 7</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36609"></a>36609</td>
<td class="instruction">OR 32</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36611"></a>36611</td>
<td class="instruction">AND E</td>
<td class="comment-11" rowspan="1">Reset bit 0 if the conveyor is moving right, or bit 1 if it's moving left</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36612"></a>36612</td>
<td class="instruction">LD E,A</td>
<td class="comment-11" rowspan="1">Save the result in <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36613"></a>36613</td>
<td class="instruction">LD A,(34271)</td>
<td class="comment-11" rowspan="1">Pick up the game mode indicator (0, 1 or 2) from <a class="link" href="34271.html">34271</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36616"></a>36616</td>
<td class="instruction">AND 2</td>
<td class="comment-11" rowspan="2">Now <span class="register">A</span>=1 if Willy is running to the toilet, 0 otherwise</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36618"></a>36618</td>
<td class="instruction">RRCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36619"></a>36619</td>
<td class="instruction">XOR E</td>
<td class="comment-11" rowspan="2">Flip bit 0 of <span class="register">E</span> if Willy is running to the toilet, forcing him to move right (unless he's jumped onto the bed, in which case bit 0 of <span class="register">E</span> is now set, and Willy is immobilised; this is a <a class="link" href="../reference/bugs.html#theStickyBed">bug</a>)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36620"></a>36620</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36621"></a>36621</td>
<td class="instruction">LD BC,64510</td>
<td class="comment-11" rowspan="2">Read keys Q-W-E-R-T (left, right, left, right, left) into bits 0-4 of <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36624"></a>36624</td>
<td class="instruction">IN A,(C)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36626"></a>36626</td>
<td class="instruction">AND 31</td>
<td class="comment-11" rowspan="3">Keep only bits 0-4, shift them into bits 1-5, and set bit 0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36628"></a>36628</td>
<td class="instruction">RLC A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36630"></a>36630</td>
<td class="instruction">OR 1</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36632"></a>36632</td>
<td class="instruction">AND E</td>
<td class="comment-11" rowspan="2">Merge this keyboard reading into bits 1-5 of <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36633"></a>36633</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36634"></a>36634</td>
<td class="instruction">LD B,231</td>
<td class="comment-11" rowspan="2">Read keys 1-2-3-4-5 ('5' is left) and 0-9-8-7-6 (jump, nothing, right, right, left) into bits 0-4 of <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36636"></a>36636</td>
<td class="instruction">IN A,(C)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36638"></a>36638</td>
<td class="instruction">RRCA</td>
<td class="comment-11" rowspan="2">Rotate the result right and set bits 0-2 and 4-7; this ignores every key except '5' and '6' (left)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36639"></a>36639</td>
<td class="instruction">OR 247</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36641"></a>36641</td>
<td class="instruction">AND E</td>
<td class="comment-11" rowspan="2">Merge this reading of the '5' and '6' keys into bit 3 of <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36642"></a>36642</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36643"></a>36643</td>
<td class="instruction">LD B,239</td>
<td class="comment-11" rowspan="2">Read keys 0-9-8-7-6 (jump, nothing, right, right, left) into bits 0-4 of <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36645"></a>36645</td>
<td class="instruction">IN A,(C)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36647"></a>36647</td>
<td class="instruction">OR 251</td>
<td class="comment-11" rowspan="1">Set bits 0, 1 and 3-7; this ignores every key except '8' (right)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36649"></a>36649</td>
<td class="instruction">AND E</td>
<td class="comment-11" rowspan="2">Merge this reading of the '8' key into bit 2 of <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36650"></a>36650</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36651"></a>36651</td>
<td class="instruction">IN A,(C)</td>
<td class="comment-11" rowspan="1">Read keys 0-9-8-7-6 (jump, nothing, right, right, left) into bits 0-4 of <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36653"></a>36653</td>
<td class="instruction">RRCA</td>
<td class="comment-11" rowspan="2">Rotate the result right and set bits 0, 1 and 3-7; this ignores every key except '7' (right)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36654"></a>36654</td>
<td class="instruction">OR 251</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36656"></a>36656</td>
<td class="instruction">AND E</td>
<td class="comment-11" rowspan="2">Merge this reading of the '7' key into bit 2 of <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36657"></a>36657</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36658"></a>36658</td>
<td class="instruction">LD A,(34254)</td>
<td class="comment-11" rowspan="1">Collect the Kempston joystick indicator from <a class="link" href="34254.html">34254</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36661"></a>36661</td>
<td class="instruction">OR A</td>
<td class="comment-11" rowspan="1">Is the joystick connected?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36662"></a>36662</td>
<td class="instruction">JR Z,<a class="link" href="36564.html#36674">36674</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36664"></a>36664</td>
<td class="instruction">LD BC,31</td>
<td class="comment-11" rowspan="2">Collect input from the joystick</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36667"></a>36667</td>
<td class="instruction">IN A,(C)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36669"></a>36669</td>
<td class="instruction">AND 3</td>
<td class="comment-11" rowspan="2">Keep only bits 0 (right) and 1 (left) and flip them</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36671"></a>36671</td>
<td class="instruction">CPL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36672"></a>36672</td>
<td class="instruction">AND E</td>
<td class="comment-11" rowspan="2">Merge this reading of the joystick right and left buttons into bits 0 and 1 of <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36673"></a>36673</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="36674"></a>
<div class="comments">
<div class="paragraph">
At this point, bits 0-5 in <span class="register">E</span> indicate the direction in which Willy is being moved or trying to move. If bit 0, 2 or 4 is reset, Willy is being moved or trying to move right; if bit 1, 3 or 5 is reset, Willy is being moved or trying to move left.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36674"></a>36674</td>
<td class="instruction">LD C,0</td>
<td class="comment-11" rowspan="1">Initialise <span class="register">C</span> to 0 (no movement)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36676"></a>36676</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="1">Copy the movement bits into <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36677"></a>36677</td>
<td class="instruction">AND 42</td>
<td class="comment-11" rowspan="1">Keep only bits 1, 3 and 5 (the 'left' bits)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36679"></a>36679</td>
<td class="instruction">CP 42</td>
<td class="comment-11" rowspan="1">Are any of these bits reset?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36681"></a>36681</td>
<td class="instruction">JR Z,<a class="link" href="36564.html#36689">36689</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36683"></a>36683</td>
<td class="instruction">LD C,4</td>
<td class="comment-11" rowspan="1">Set bit 2 of <span class="register">C</span>: Willy is moving left</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36685"></a>36685</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="2">Reset the inactivity timer at <a class="link" href="34272.html">34272</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36686"></a>36686</td>
<td class="instruction">LD (34272),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36689"></a>36689</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="1">Copy the movement bits into <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36690"></a>36690</td>
<td class="instruction">AND 21</td>
<td class="comment-11" rowspan="1">Keep only bits 0, 2 and 4 (the 'right' bits)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36692"></a>36692</td>
<td class="instruction">CP 21</td>
<td class="comment-11" rowspan="1">Are any of these bits reset?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36694"></a>36694</td>
<td class="instruction">JR Z,<a class="link" href="36564.html#36702">36702</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36696"></a>36696</td>
<td class="instruction">SET 3,C</td>
<td class="comment-11" rowspan="1">Set bit 3 of <span class="register">C</span>: Willy is moving right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36698"></a>36698</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="2">Reset the inactivity timer at <a class="link" href="34272.html">34272</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36699"></a>36699</td>
<td class="instruction">LD (34272),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36702"></a>36702</td>
<td class="instruction">LD A,(34256)</td>
<td class="comment-11" rowspan="1">Pick up Willy's direction and movement flags from <a class="link" href="34256.html">34256</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36705"></a>36705</td>
<td class="instruction">ADD A,C</td>
<td class="comment-11" rowspan="5">Point <span class="register">HL</span> at the entry in the left-right movement table at <a class="link" href="33825.html">33825</a> that corresponds to the direction Willy is facing, and the direction in which he is being moved or trying to move</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36706"></a>36706</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36707"></a>36707</td>
<td class="instruction">LD B,0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36709"></a>36709</td>
<td class="instruction">LD HL,33825</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36712"></a>36712</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36713"></a>36713</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="2">Update Willy's direction and movement flags at <a class="link" href="34256.html">34256</a> with the entry from the left-right movement table</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36714"></a>36714</td>
<td class="instruction">LD (34256),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="36717"></a>
<div class="comments">
<div class="paragraph">
That is left-right movement taken care of. Now check the jump keys.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36717"></a>36717</td>
<td class="instruction">LD BC,32510</td>
<td class="comment-11" rowspan="2">Read keys SHIFT-Z-X-C-V and B-N-M-SS-SPACE</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36720"></a>36720</td>
<td class="instruction">IN A,(C)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36722"></a>36722</td>
<td class="instruction">AND 31</td>
<td class="comment-11" rowspan="2">Are any of these keys being pressed?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36724"></a>36724</td>
<td class="instruction">CP 31</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36726"></a>36726</td>
<td class="instruction">JR NZ,<a class="link" href="36564.html#36751">36751</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36728"></a>36728</td>
<td class="instruction">LD B,239</td>
<td class="comment-11" rowspan="2">Read keys 6-7-8-9-0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36730"></a>36730</td>
<td class="instruction">IN A,(C)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36732"></a>36732</td>
<td class="instruction">BIT 0,A</td>
<td class="comment-11" rowspan="1">Is '0' being pressed?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36734"></a>36734</td>
<td class="instruction">JR Z,<a class="link" href="36564.html#36751">36751</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36736"></a>36736</td>
<td class="instruction">LD A,(34254)</td>
<td class="comment-11" rowspan="1">Collect the Kempston joystick indicator from <a class="link" href="34254.html">34254</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36739"></a>36739</td>
<td class="instruction">OR A</td>
<td class="comment-11" rowspan="1">Is the joystick connected?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36740"></a>36740</td>
<td class="instruction">JR Z,<a class="link" href="36796.html">36796</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36742"></a>36742</td>
<td class="instruction">LD BC,31</td>
<td class="comment-11" rowspan="2">Collect input from the joystick</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36745"></a>36745</td>
<td class="instruction">IN A,(C)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36747"></a>36747</td>
<td class="instruction">BIT 4,A</td>
<td class="comment-11" rowspan="1">Is the fire button being pressed?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36749"></a>36749</td>
<td class="instruction">JR Z,<a class="link" href="36796.html">36796</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="36751"></a>
<div class="comments">
<div class="paragraph">
A jump key or the fire button is being pressed. Time to make Willy jump.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36751"></a>36751</td>
<td class="instruction">LD A,(34271)</td>
<td class="comment-11" rowspan="1">Pick up the game mode indicator from <a class="link" href="34271.html">34271</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36754"></a>36754</td>
<td class="instruction">BIT 1,A</td>
<td class="comment-11" rowspan="1">Is Willy running to the toilet?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36756"></a>36756</td>
<td class="instruction">JR NZ,<a class="link" href="36796.html">36796</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36758"></a>36758</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="2">Initialise the jumping animation counter at <a class="link" href="34261.html">34261</a> to 0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36759"></a>36759</td>
<td class="instruction">LD (34261),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36762"></a>36762</td>
<td class="instruction">LD (34272),A</td>
<td class="comment-11" rowspan="1">Reset the inactivity timer at <a class="link" href="34272.html">34272</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36765"></a>36765</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="2">Set the airborne status indicator at <a class="link" href="34257.html">34257</a> to 1: Willy is jumping</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36766"></a>36766</td>
<td class="instruction">LD (34257),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36769"></a>36769</td>
<td class="instruction">LD A,(34262)</td>
<td class="comment-11" rowspan="1">Pick up the rope status indicator from <a class="link" href="34262.html">34262</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36772"></a>36772</td>
<td class="instruction">DEC A</td>
<td class="comment-11" rowspan="2">Is Willy on a rope?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36773"></a>36773</td>
<td class="instruction">BIT 7,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36775"></a>36775</td>
<td class="instruction">JR NZ,<a class="link" href="36796.html">36796</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36777"></a>36777</td>
<td class="instruction">LD A,240</td>
<td class="comment-11" rowspan="2">Set the rope status indicator at <a class="link" href="34262.html">34262</a> to 240</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36779"></a>36779</td>
<td class="instruction">LD (34262),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36782"></a>36782</td>
<td class="instruction">LD A,(34255)</td>
<td class="comment-11" rowspan="3">Round down Willy's pixel y-coordinate at <a class="link" href="34255.html">34255</a> to the nearest multiple of 16; this might move him upwards a little, but ensures that his actual pixel y-coordinate is a multiple of 8 (making his sprite cell-aligned) before he begins the jump off the rope</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36785"></a>36785</td>
<td class="instruction">AND 240</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36787"></a>36787</td>
<td class="instruction">LD (34255),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36790"></a>36790</td>
<td class="instruction">LD HL,34256</td>
<td class="comment-11" rowspan="2">Set bit 1 at <a class="link" href="34256.html">34256</a>: during this jump off the rope, Willy will move in the direction he's facing</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36793"></a>36793</td>
<td class="instruction">SET 1,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36795"></a>36795</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="36307.html">36307</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#36564">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="36796.html">36796</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Jet Set Willy RAM disassembly 20141114</div>
<div class="copyright">&#169; 1984 Software Projects Ltd (Jet Set Willy). &#169; 2014 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.1.1.</div>
</div>
</body>
</html>