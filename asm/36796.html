<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Jet Set Willy: Routine at 36796</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="Jet Set Willy" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="36564.html">36564</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#36796">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="37046.html">37046</a></span></td>
</tr>
</table>
<div class="description">36796: Move Willy (3)</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routines at <a class="link" href="36307.html">36307</a> and <a class="link" href="36564.html">36564</a>. This routine moves Willy left or right if necessary.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36796"></a>36796</td>
<td class="instruction">LD A,(34256)</td>
<td class="comment-11" rowspan="1">Pick up Willy's direction and movement flags from <a class="link" href="34256.html">34256</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36799"></a>36799</td>
<td class="instruction">AND 2</td>
<td class="comment-11" rowspan="1">Is Willy moving?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36801"></a>36801</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36802"></a>36802</td>
<td class="instruction">LD A,(34262)</td>
<td class="comment-11" rowspan="1">Pick up the rope status indicator from <a class="link" href="34262.html">34262</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36805"></a>36805</td>
<td class="instruction">DEC A</td>
<td class="comment-11" rowspan="2">Is Willy on a rope?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36806"></a>36806</td>
<td class="instruction">BIT 7,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36808"></a>36808</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if so (Willy's movement along a rope is handled at <a class="link" href="37310.html#37726">37726</a>)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36809"></a>36809</td>
<td class="instruction">LD A,(34256)</td>
<td class="comment-11" rowspan="1">Pick up Willy's direction and movement flags from <a class="link" href="34256.html">34256</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36812"></a>36812</td>
<td class="instruction">AND 1</td>
<td class="comment-11" rowspan="1">Is Willy facing right?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36814"></a>36814</td>
<td class="instruction">JP Z,<a class="link" href="36796.html#36930">36930</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="36817"></a>
<div class="comments">
<div class="paragraph">
Willy is moving left.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36817"></a>36817</td>
<td class="instruction">LD A,(34258)</td>
<td class="comment-11" rowspan="1">Pick up Willy's animation frame from <a class="link" href="34258.html">34258</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36820"></a>36820</td>
<td class="instruction">OR A</td>
<td class="comment-11" rowspan="1">Is it 0?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36821"></a>36821</td>
<td class="instruction">JR Z,<a class="link" href="36796.html#36828">36828</a></td>
<td class="comment-11" rowspan="1">If so, jump to move Willy's sprite left across a cell boundary</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36823"></a>36823</td>
<td class="instruction">DEC A</td>
<td class="comment-11" rowspan="2">Decrement Willy's animation frame at <a class="link" href="34258.html">34258</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36824"></a>36824</td>
<td class="instruction">LD (34258),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36827"></a>36827</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="36828"></a>
<div class="comments">
<div class="paragraph">
Willy's sprite is moving left across a cell boundary. In the comments that follow, (x,y) refers to the coordinates of the top-left cell currently occupied by Willy's sprite.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36828"></a>36828</td>
<td class="instruction">LD A,(34257)</td>
<td class="comment-11" rowspan="1">Pick up the airborne status indicator from <a class="link" href="34257.html">34257</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36831"></a>36831</td>
<td class="instruction">LD BC,0</td>
<td class="comment-11" rowspan="1">Prepare <span class="register">BC</span> for later addition</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36834"></a>36834</td>
<td class="instruction">CP 0</td>
<td class="comment-11" rowspan="1">Is Willy jumping?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36836"></a>36836</td>
<td class="instruction">JR NZ,<a class="link" href="36796.html#36874">36874</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36838"></a>36838</td>
<td class="instruction">LD HL,(34259)</td>
<td class="comment-11" rowspan="1">Collect Willy's attribute buffer coordinates from <a class="link" href="34259.html">34259</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36841"></a>36841</td>
<td class="instruction">LD BC,0</td>
<td class="comment-11" rowspan="1">Prepare <span class="register">BC</span> for later addition (again, redundantly)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36844"></a>36844</td>
<td class="instruction">LD A,(32986)</td>
<td class="comment-11" rowspan="1">Pick up the direction byte of the ramp definition for the current room from <a class="link" href="32986.html">32986</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36847"></a>36847</td>
<td class="instruction">DEC A</td>
<td class="comment-11" rowspan="3">Now <span class="register">A</span>=31 if the ramp goes up to the left, or 65 if it goes up to the right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36848"></a>36848</td>
<td class="instruction">OR 161</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36850"></a>36850</td>
<td class="instruction">XOR 224</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36852"></a>36852</td>
<td class="instruction">LD E,A</td>
<td class="comment-11" rowspan="3">Point <span class="register">HL</span> at the cell at (x-1,y+1) if the ramp goes up to the left, or at the cell at (x+1,y+2) if the ramp goes up to the right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36853"></a>36853</td>
<td class="instruction">LD D,0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36855"></a>36855</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36856"></a>36856</td>
<td class="instruction">LD A,(32964)</td>
<td class="comment-11" rowspan="1">Pick up the attribute byte of the ramp tile for the current room from <a class="link" href="32928.html#32964">32964</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36859"></a>36859</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Is there a ramp tile in the cell pointed to by <span class="register">HL</span>?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36860"></a>36860</td>
<td class="instruction">JR NZ,<a class="link" href="36796.html#36874">36874</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36862"></a>36862</td>
<td class="instruction">LD BC,32</td>
<td class="comment-11" rowspan="1">Prepare <span class="register">BC</span> for later addition</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36865"></a>36865</td>
<td class="instruction">LD A,(32986)</td>
<td class="comment-11" rowspan="1">Pick up the direction byte of the ramp definition for the current room from <a class="link" href="32986.html">32986</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36868"></a>36868</td>
<td class="instruction">OR A</td>
<td class="comment-11" rowspan="1">Does the ramp go up to the right?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36869"></a>36869</td>
<td class="instruction">JR NZ,<a class="link" href="36796.html#36874">36874</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36871"></a>36871</td>
<td class="instruction">LD BC,65504</td>
<td class="comment-11" rowspan="1"><span class="register">BC</span>=-32 (the ramp goes up to the left)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36874"></a>36874</td>
<td class="instruction">LD HL,(34259)</td>
<td class="comment-11" rowspan="1">Collect Willy's attribute buffer coordinates from <a class="link" href="34259.html">34259</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36877"></a>36877</td>
<td class="instruction">LD A,L</td>
<td class="comment-11" rowspan="2">Is Willy's screen x-coordinate 0 (on the far left)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36878"></a>36878</td>
<td class="instruction">AND 31</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36880"></a>36880</td>
<td class="instruction">JP Z,<a class="link" href="38026.html">38026</a></td>
<td class="comment-11" rowspan="1">If so, move Willy into the room to the left</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36883"></a>36883</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-11" rowspan="4">Point <span class="register">HL</span> at the cell at (x-1,y+1), or at the cell at (x-1,y) if Willy is on or approaching a ramp that goes up to the left, or at the cell at (x-1,y+2) if Willy is walking down a ramp</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36884"></a>36884</td>
<td class="instruction">DEC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36885"></a>36885</td>
<td class="instruction">LD DE,32</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36888"></a>36888</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36889"></a>36889</td>
<td class="instruction">LD A,(32946)</td>
<td class="comment-11" rowspan="1">Pick up the attribute byte of the wall tile for the current room from <a class="link" href="32928.html#32946">32946</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36892"></a>36892</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Is there a wall tile in the cell pointed to by <span class="register">HL</span>?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36893"></a>36893</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if so without moving Willy (his path is blocked)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36894"></a>36894</td>
<td class="instruction">LD A,(34255)</td>
<td class="comment-11" rowspan="1">Pick up Willy's pixel y-coordinate (Y) from <a class="link" href="34255.html">34255</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36897"></a>36897</td>
<td class="instruction">SRA C</td>
<td class="comment-11" rowspan="3">Now <span class="register">B</span>=Y (if Willy is neither on nor approaching a ramp), or Y+16 (if Willy is walking down a ramp), or Y-16 (if Willy is on or approaching a ramp that goes up to the left); this will be Willy's new pixel y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36899"></a>36899</td>
<td class="instruction">ADD A,C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36900"></a>36900</td>
<td class="instruction">LD B,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36901"></a>36901</td>
<td class="instruction">AND 15</td>
<td class="comment-11" rowspan="1">Does Willy's sprite currently occupy only two rows of cells?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36903"></a>36903</td>
<td class="instruction">JR Z,<a class="link" href="36796.html#36914">36914</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36905"></a>36905</td>
<td class="instruction">LD A,(32946)</td>
<td class="comment-11" rowspan="1">Pick up the attribute byte of the wall tile for the current room from <a class="link" href="32928.html#32946">32946</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36908"></a>36908</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the cell at (x-1,y+2), or at the cell at (x-1,y+1) if Willy is on or approaching a ramp that goes up to the left, or at the cell at (x-1,y+3) if Willy is on a ramp that goes up to the right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36909"></a>36909</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Is there a wall tile in the cell pointed to by <span class="register">HL</span>?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36910"></a>36910</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if so without moving Willy (his path is blocked)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36911"></a>36911</td>
<td class="instruction">OR A</td>
<td class="comment-11" rowspan="2">Point <span class="register">HL</span> at the cell at (x-1,y+1), or at the cell at (x-1,y) if Willy is on or approaching a ramp that goes up to the left, or at the cell at (x-1,y+2) if Willy is walking down a ramp</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36912"></a>36912</td>
<td class="instruction">SBC HL,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36914"></a>36914</td>
<td class="instruction">OR A</td>
<td class="comment-11" rowspan="2">Point <span class="register">HL</span> at the cell at (x-1,y), or at the cell at (x-1,y-1) if Willy is on or approaching a ramp that goes up to the left, or at the cell at (x-1,y+1) if Willy is walking down a ramp</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36915"></a>36915</td>
<td class="instruction">SBC HL,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36917"></a>36917</td>
<td class="instruction">LD (34259),HL</td>
<td class="comment-11" rowspan="1">Save Willy's new attribute buffer coordinates (in <span class="register">HL</span>) at <a class="link" href="34259.html">34259</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36920"></a>36920</td>
<td class="instruction">LD A,B</td>
<td class="comment-11" rowspan="2">Save Willy's new pixel y-coordinate at <a class="link" href="34255.html">34255</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36921"></a>36921</td>
<td class="instruction">LD (34255),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36924"></a>36924</td>
<td class="instruction">LD A,3</td>
<td class="comment-11" rowspan="2">Change Willy's animation frame at <a class="link" href="34258.html">34258</a> from 0 to 3</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36926"></a>36926</td>
<td class="instruction">LD (34258),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36929"></a>36929</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="36930"></a>
<div class="comments">
<div class="paragraph">
Willy is moving right.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36930"></a>36930</td>
<td class="instruction">LD A,(34258)</td>
<td class="comment-11" rowspan="1">Pick up Willy's animation frame from <a class="link" href="34258.html">34258</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36933"></a>36933</td>
<td class="instruction">CP 3</td>
<td class="comment-11" rowspan="1">Is it 3?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36935"></a>36935</td>
<td class="instruction">JR Z,<a class="link" href="36796.html#36942">36942</a></td>
<td class="comment-11" rowspan="1">If so, jump to move Willy's sprite right across a cell boundary</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36937"></a>36937</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="2">Increment Willy's animation frame at <a class="link" href="34258.html">34258</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36938"></a>36938</td>
<td class="instruction">LD (34258),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36941"></a>36941</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="36942"></a>
<div class="comments">
<div class="paragraph">
Willy's sprite is moving right across a cell boundary. In the comments that follow, (x,y) refers to the coordinates of the top-left cell currently occupied by Willy's sprite.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36942"></a>36942</td>
<td class="instruction">LD A,(34257)</td>
<td class="comment-11" rowspan="1">Pick up the airborne status indicator from <a class="link" href="34257.html">34257</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36945"></a>36945</td>
<td class="instruction">LD BC,0</td>
<td class="comment-11" rowspan="1">Prepare <span class="register">BC</span> for later addition</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36948"></a>36948</td>
<td class="instruction">OR A</td>
<td class="comment-11" rowspan="1">Is Willy jumping or falling?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36949"></a>36949</td>
<td class="instruction">JR NZ,<a class="link" href="36796.html#36984">36984</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36951"></a>36951</td>
<td class="instruction">LD HL,(34259)</td>
<td class="comment-11" rowspan="1">Collect Willy's attribute buffer coordinates from <a class="link" href="34259.html">34259</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36954"></a>36954</td>
<td class="instruction">LD A,(32986)</td>
<td class="comment-11" rowspan="1">Pick up the direction byte of the ramp definition for the current room from <a class="link" href="32986.html">32986</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36957"></a>36957</td>
<td class="instruction">DEC A</td>
<td class="comment-11" rowspan="3">Now <span class="register">A</span>=64 if the ramp goes up to the left, or 34 if it goes up to the right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36958"></a>36958</td>
<td class="instruction">OR 157</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36960"></a>36960</td>
<td class="instruction">XOR 191</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36962"></a>36962</td>
<td class="instruction">LD E,A</td>
<td class="comment-11" rowspan="3">Point <span class="register">HL</span> at the cell at (x,y+2) if the ramp goes up to the left, or at the cell at (x+2,y+1) if the ramp goes up to the right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36963"></a>36963</td>
<td class="instruction">LD D,0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36965"></a>36965</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36966"></a>36966</td>
<td class="instruction">LD A,(32964)</td>
<td class="comment-11" rowspan="1">Pick up the attribute byte of the ramp tile for the current room from <a class="link" href="32928.html#32964">32964</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36969"></a>36969</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Is there a ramp tile in the cell pointed to by <span class="register">HL</span>?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36970"></a>36970</td>
<td class="instruction">JR NZ,<a class="link" href="36796.html#36984">36984</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36972"></a>36972</td>
<td class="instruction">LD BC,32</td>
<td class="comment-11" rowspan="1">Prepare <span class="register">BC</span> for later addition</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36975"></a>36975</td>
<td class="instruction">LD A,(32986)</td>
<td class="comment-11" rowspan="1">Pick up the direction byte of the ramp definition for the current room from <a class="link" href="32986.html">32986</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36978"></a>36978</td>
<td class="instruction">OR A</td>
<td class="comment-11" rowspan="1">Does the ramp go up to the left?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36979"></a>36979</td>
<td class="instruction">JR Z,<a class="link" href="36796.html#36984">36984</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36981"></a>36981</td>
<td class="instruction">LD BC,65504</td>
<td class="comment-11" rowspan="1"><span class="register">BC</span>=-32 (the ramp goes up to the right)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36984"></a>36984</td>
<td class="instruction">LD HL,(34259)</td>
<td class="comment-11" rowspan="1">Collect Willy's attribute buffer coordinates from <a class="link" href="34259.html">34259</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36987"></a>36987</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-11" rowspan="3">Point <span class="register">HL</span> at the cell at (x+2,y), or at the cell at (x+2,y+1) if Willy is walking down a ramp, or at the cell at (x+2,y-1) if Willy is on or approaching a ramp that goes up to the right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36988"></a>36988</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36989"></a>36989</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36990"></a>36990</td>
<td class="instruction">LD A,L</td>
<td class="comment-11" rowspan="2">Is Willy's screen x-coordinate 30 (on the far right)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36991"></a>36991</td>
<td class="instruction">AND 31</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36993"></a>36993</td>
<td class="instruction">JP Z,<a class="link" href="38046.html">38046</a></td>
<td class="comment-11" rowspan="1">If so, move Willy into the room on the right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36996"></a>36996</td>
<td class="instruction">LD DE,32</td>
<td class="comment-11" rowspan="1">Prepare <span class="register">DE</span> for addition</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36999"></a>36999</td>
<td class="instruction">LD A,(32946)</td>
<td class="comment-11" rowspan="1">Pick up the attribute byte of the wall tile for the current room from <a class="link" href="32928.html#32946">32946</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37002"></a>37002</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the cell at (x+2,y+1), or at the cell at (x+2,y+2) if Willy is walking down a ramp, or at the cell at (x+2,y) if Willy is on or approaching a ramp that goes up to the right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37003"></a>37003</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Is there a wall tile in the cell pointed to by <span class="register">HL</span>?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37004"></a>37004</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if so without moving Willy (his path is blocked)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37005"></a>37005</td>
<td class="instruction">LD A,(34255)</td>
<td class="comment-11" rowspan="1">Pick up Willy's pixel y-coordinate (Y) from <a class="link" href="34255.html">34255</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37008"></a>37008</td>
<td class="instruction">SRA C</td>
<td class="comment-11" rowspan="3">Now <span class="register">B</span>=Y (if Willy is neither on nor approaching a ramp), or Y+16 (if Willy is walking down a ramp), or Y-16 (if Willy is on or approaching a ramp that goes up to the right); this will be Willy's new pixel y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37010"></a>37010</td>
<td class="instruction">ADD A,C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37011"></a>37011</td>
<td class="instruction">LD B,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37012"></a>37012</td>
<td class="instruction">AND 15</td>
<td class="comment-11" rowspan="1">Does Willy's sprite currently occupy only two rows of cells?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37014"></a>37014</td>
<td class="instruction">JR Z,<a class="link" href="36796.html#37025">37025</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37016"></a>37016</td>
<td class="instruction">LD A,(32946)</td>
<td class="comment-11" rowspan="1">Pick up the attribute byte of the wall tile for the current room from <a class="link" href="32928.html#32946">32946</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37019"></a>37019</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the cell at (x+2,y+2), or at the cell at (x+2,y+3) if Willy is walking down a ramp, or at the cell at (x+2,y+1) if Willy is on or approaching a ramp that goes up to the right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37020"></a>37020</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Is there a wall tile in the cell pointed to by <span class="register">HL</span>?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37021"></a>37021</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if so without moving Willy (his path is blocked)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37022"></a>37022</td>
<td class="instruction">OR A</td>
<td class="comment-11" rowspan="2">Point <span class="register">HL</span> at the cell at (x+2,y+1), or at the cell at (x+2,y+2) if Willy is walking down a ramp, or at the cell at (x+2,y) if Willy is on or approaching a ramp that goes up to the right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37023"></a>37023</td>
<td class="instruction">SBC HL,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="37025"></a>37025</td>
<td class="instruction">LD A,(32946)</td>
<td class="comment-11" rowspan="1">Pick up the attribute byte of the wall tile for the current room from <a class="link" href="32928.html#32946">32946</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37028"></a>37028</td>
<td class="instruction">OR A</td>
<td class="comment-11" rowspan="2">Point <span class="register">HL</span> at the cell at (x+2,y), or at the cell at (x+2,y+1) if Willy is walking down a ramp, or at the cell at (x+2,y-1) if Willy is on or approaching a ramp that goes up to the right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37029"></a>37029</td>
<td class="instruction">SBC HL,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37031"></a>37031</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Is there a wall tile in the cell pointed to by <span class="register">HL</span>?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37032"></a>37032</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if so without moving Willy (his path is blocked)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37033"></a>37033</td>
<td class="instruction">DEC HL</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the cell at (x+1,y), or at the cell at (x+1,y+1) if Willy is walking down a ramp, or at the cell at (x+1,y-1) if Willy is on or approaching a ramp that goes up to the right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37034"></a>37034</td>
<td class="instruction">LD (34259),HL</td>
<td class="comment-11" rowspan="1">Save Willy's new attribute buffer coordinates (in <span class="register">HL</span>) at <a class="link" href="34259.html">34259</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37037"></a>37037</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="2">Change Willy's animation frame at <a class="link" href="34258.html">34258</a> from 3 to 0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37038"></a>37038</td>
<td class="instruction">LD (34258),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37041"></a>37041</td>
<td class="instruction">LD A,B</td>
<td class="comment-11" rowspan="2">Save Willy's new pixel y-coordinate at <a class="link" href="34255.html">34255</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37042"></a>37042</td>
<td class="instruction">LD (34255),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37045"></a>37045</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="36564.html">36564</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#36796">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="37046.html">37046</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Jet Set Willy RAM disassembly 20150328</div>
<div class="copyright">&#169; 1984 Software Projects Ltd (Jet Set Willy). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.3.</div>
</div>
</body>
</html>