<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Jet Set Willy: Routine at 35591</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="35563.html">35563</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#35591">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="35841.html">35841</a></span></td>
</tr>
</table>
<div class="description">35591: Main loop (2)</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="35245.html">35245</a>. The main entry point is used when resuming the game after it has been paused.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="35591"></a>35591</td>
<td class="instruction">LD HL,39424</td>
<td class="comment-11" rowspan="4">Copy the attribute bytes from <a class="link" href="39424.html">39424</a> to the bottom third of the screen</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35594"></a>35594</td>
<td class="instruction">LD DE,23040</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35597"></a>35597</td>
<td class="instruction">LD BC,256</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35600"></a>35600</td>
<td class="instruction">LDIR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35602"></a>35602</td>
<td class="instruction">LD A,(32990)</td>
<td class="comment-11" rowspan="1">Pick up the border colour for the current room from <a class="link" href="32990.html">32990</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35605"></a>35605</td>
<td class="instruction">OUT (254),A</td>
<td class="comment-11" rowspan="1">Restore the border colour</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="35607"></a>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a class="link" href="35245.html">35245</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="35607"></a>35607</td>
<td class="instruction">LD A,(34257)</td>
<td class="comment-11" rowspan="1">Pick up the airborne status indicator from <a class="link" href="34257.html">34257</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35610"></a>35610</td>
<td class="instruction">CP 255</td>
<td class="comment-11" rowspan="1">Has Willy landed after falling from too great a height, or collided with a nasty, an arrow, a guardian, or Maria?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35612"></a>35612</td>
<td class="instruction">JP Z,<a class="link" href="35841.html">35841</a></td>
<td class="comment-11" rowspan="1">If so, lose a life</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="35615"></a>
<div class="comments">
<div class="paragraph">
Now read the keys H, J, K, L and ENTER (which toggle the in-game music).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35615"></a>35615</td>
<td class="instruction">LD B,191</td>
<td class="comment-11" rowspan="1">Prepare <span class="register">B</span> for reading keys H-J-K-L-ENTER</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35617"></a>35617</td>
<td class="instruction">LD HL,34274</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the music flags at <a class="link" href="34274.html">34274</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35620"></a>35620</td>
<td class="instruction">IN A,(C)</td>
<td class="comment-11" rowspan="1">Read keys H-J-K-L-ENTER; note that if the game has just resumed after being paused, <span class="register">C</span> holds 0 instead of 254, which is a <a class="link" href="../reference/bugs.html#thePauseBug">bug</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35622"></a>35622</td>
<td class="instruction">AND 31</td>
<td class="comment-11" rowspan="2">Are any of these keys being pressed?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35624"></a>35624</td>
<td class="instruction">CP 31</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35626"></a>35626</td>
<td class="instruction">JR Z,<a class="link" href="35591.html#35638">35638</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35628"></a>35628</td>
<td class="instruction">BIT 0,(HL)</td>
<td class="comment-11" rowspan="1">Were any of these keys being pressed the last time we checked?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35630"></a>35630</td>
<td class="instruction">JR NZ,<a class="link" href="35591.html#35640">35640</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35632"></a>35632</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="3">Set bit 0 (the keypress flag) and flip bit 1 (the in-game music flag) at <a class="link" href="34274.html">34274</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35633"></a>35633</td>
<td class="instruction">XOR 3</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35635"></a>35635</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35636"></a>35636</td>
<td class="instruction">JR <a class="link" href="35591.html#35640">35640</a></td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="35638"></a>35638</td>
<td class="instruction">RES 0,(HL)</td>
<td class="comment-11" rowspan="1">Reset bit 0 (the keypress flag) at <a class="link" href="34274.html">34274</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="35640"></a>35640</td>
<td class="instruction">BIT 1,(HL)</td>
<td class="comment-11" rowspan="1">Has the in-game music been switched off?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35642"></a>35642</td>
<td class="instruction">JR NZ,<a class="link" href="35591.html#35696">35696</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="35644"></a>
<div class="comments">
<div class="paragraph">
The next section of code plays a note of the in-game music.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35644"></a>35644</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="2">Reset the inactivity timer at <a class="link" href="34272.html">34272</a> (the game does not automatically pause after a period of inactivity if the in-game music is playing)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35645"></a>35645</td>
<td class="instruction">LD (34272),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35648"></a>35648</td>
<td class="instruction">LD A,(34273)</td>
<td class="comment-11" rowspan="3">Increment the in-game music note index at <a class="link" href="34273.html">34273</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35651"></a>35651</td>
<td class="instruction">INC A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35652"></a>35652</td>
<td class="instruction">LD (34273),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35655"></a>35655</td>
<td class="instruction">AND 126</td>
<td class="comment-11" rowspan="6">Point <span class="register">HL</span> at the appropriate entry in the tune data table at <a class="link" href="34399.html">34399</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35657"></a>35657</td>
<td class="instruction">RRCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35658"></a>35658</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35659"></a>35659</td>
<td class="instruction">LD D,0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35661"></a>35661</td>
<td class="instruction">LD HL,34399</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35664"></a>35664</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35665"></a>35665</td>
<td class="instruction">LD A,(34252)</td>
<td class="comment-11" rowspan="1">Pick up the number of lives remaining (0-7) from <a class="link" href="34252.html">34252</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35668"></a>35668</td>
<td class="instruction">RLCA</td>
<td class="comment-11" rowspan="4"><span class="register">A</span>=28-4<span class="register">A</span>; this value adjusts the pitch of the note that is played depending on how many lives are remaining (the more lives remaining, the higher the pitch)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35669"></a>35669</td>
<td class="instruction">RLCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35670"></a>35670</td>
<td class="instruction">SUB 28</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35672"></a>35672</td>
<td class="instruction">NEG</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35674"></a>35674</td>
<td class="instruction">ADD A,(HL)</td>
<td class="comment-11" rowspan="1">Add the entry from the tune data table for the current note</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35675"></a>35675</td>
<td class="instruction">LD D,A</td>
<td class="comment-11" rowspan="1">Copy this value to <span class="register">D</span> (which determines the pitch of the note)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35676"></a>35676</td>
<td class="instruction">LD A,(32990)</td>
<td class="comment-11" rowspan="1">Pick up the border colour for the current room from <a class="link" href="32990.html">32990</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35679"></a>35679</td>
<td class="instruction">LD E,D</td>
<td class="comment-11" rowspan="1">Initialise the pitch delay counter in <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35680"></a>35680</td>
<td class="instruction">LD BC,3</td>
<td class="comment-11" rowspan="1">Initialise the duration delay counters in <span class="register">B</span> (0) and <span class="register">C</span> (3)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="35683"></a>35683</td>
<td class="instruction">OUT (254),A</td>
<td class="comment-11" rowspan="8">Produce a note of the in-game music</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35685"></a>35685</td>
<td class="instruction">DEC E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35686"></a>35686</td>
<td class="instruction">JR NZ,<a class="link" href="35591.html#35691">35691</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35688"></a>35688</td>
<td class="instruction">LD E,D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35689"></a>35689</td>
<td class="instruction">XOR 24</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="35691"></a>35691</td>
<td class="instruction">DJNZ <a class="link" href="35591.html#35683">35683</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35693"></a>35693</td>
<td class="instruction">DEC C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35694"></a>35694</td>
<td class="instruction">JR NZ,<a class="link" href="35591.html#35683">35683</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="35696"></a>
<div class="comments">
<div class="paragraph">
Here we check the teleport keys.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="35696"></a>35696</td>
<td class="instruction">LD BC,61438</td>
<td class="comment-11" rowspan="2">Read keys 6-7-8-9-0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35699"></a>35699</td>
<td class="instruction">IN A,(C)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35701"></a>35701</td>
<td class="instruction">BIT 1,A</td>
<td class="comment-11" rowspan="1">Is '9' (the activator key) being pressed?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35703"></a>35703</td>
<td class="instruction">JP NZ,<a class="link" href="35591.html#35735">35735</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35706"></a>35706</td>
<td class="instruction">AND 16</td>
<td class="comment-11" rowspan="3">Keep only bit 4 (corresponding to the '6' key), flip it, and move it into bit 5</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35708"></a>35708</td>
<td class="instruction">XOR 16</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35710"></a>35710</td>
<td class="instruction">RLCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35711"></a>35711</td>
<td class="instruction">LD D,A</td>
<td class="comment-11" rowspan="1">Now bit 5 of <span class="register">D</span> is set if '6' is being pressed</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35712"></a>35712</td>
<td class="instruction">LD A,(34275)</td>
<td class="comment-11" rowspan="1">Pick up the WRITETYPER key counter from <a class="link" href="34275.html">34275</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35715"></a>35715</td>
<td class="instruction">CP 10</td>
<td class="comment-11" rowspan="1">Has WRITETYPER been keyed in yet?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35717"></a>35717</td>
<td class="instruction">JP NZ,<a class="link" href="35591.html#35735">35735</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35720"></a>35720</td>
<td class="instruction">LD BC,63486</td>
<td class="comment-11" rowspan="2">Read keys 1-2-3-4-5</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35723"></a>35723</td>
<td class="instruction">IN A,(C)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35725"></a>35725</td>
<td class="instruction">CPL</td>
<td class="comment-11" rowspan="2">Keep only bits 0-4 and flip them</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35726"></a>35726</td>
<td class="instruction">AND 31</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35728"></a>35728</td>
<td class="instruction">OR D</td>
<td class="comment-11" rowspan="1">Copy bit 5 of <span class="register">D</span> into <span class="register">A</span>; now <span class="register">A</span> holds the number of the room to teleport to</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35729"></a>35729</td>
<td class="instruction">LD (33824),A</td>
<td class="comment-11" rowspan="1">Store the room number at <a class="link" href="33824.html">33824</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35732"></a>35732</td>
<td class="instruction">JP <a class="link" href="35068.html#35090">35090</a></td>
<td class="comment-11" rowspan="1">Teleport into the room</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="35735"></a>
<div class="comments">
<div class="paragraph">
Finally, check the WRITETYPER keys.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="35735"></a>35735</td>
<td class="instruction">LD A,(34275)</td>
<td class="comment-11" rowspan="1">Pick up the WRITETYPER key counter from <a class="link" href="34275.html">34275</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35738"></a>35738</td>
<td class="instruction">CP 10</td>
<td class="comment-11" rowspan="1">Has WRITETYPER been keyed in yet?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35740"></a>35740</td>
<td class="instruction">JP Z,<a class="link" href="35245.html">35245</a></td>
<td class="comment-11" rowspan="1">If so, jump back to the start of the main loop</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35743"></a>35743</td>
<td class="instruction">LD A,(33824)</td>
<td class="comment-11" rowspan="1">Pick up the current room number from <a class="link" href="33824.html">33824</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35746"></a>35746</td>
<td class="instruction">CP 28</td>
<td class="comment-11" rowspan="1">Are we in <a class="link" href="56320.html">First Landing</a>?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35748"></a>35748</td>
<td class="instruction">JP NZ,<a class="link" href="35245.html">35245</a></td>
<td class="comment-11" rowspan="1">If not, jump back to the start of the main loop</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35751"></a>35751</td>
<td class="instruction">LD A,(34255)</td>
<td class="comment-11" rowspan="1">Pick up Willy's pixel y-coordinate from <a class="link" href="34255.html">34255</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35754"></a>35754</td>
<td class="instruction">CP 208</td>
<td class="comment-11" rowspan="1">Is Willy on the floor at the bottom of the staircase?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35756"></a>35756</td>
<td class="instruction">JP NZ,<a class="link" href="35245.html">35245</a></td>
<td class="comment-11" rowspan="1">If not, jump back to the start of the main loop</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35759"></a>35759</td>
<td class="instruction">LD A,(34275)</td>
<td class="comment-11" rowspan="1">Pick up the WRITETYPER key counter (0-9) from <a class="link" href="34275.html">34275</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35762"></a>35762</td>
<td class="instruction">RLCA</td>
<td class="comment-11" rowspan="5">Point <span class="register">IX</span> at the corresponding entry in the WRITETYPER table at <a class="link" href="34277.html#34279">34279</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35763"></a>35763</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35764"></a>35764</td>
<td class="instruction">LD D,0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35766"></a>35766</td>
<td class="instruction">LD IX,34279</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35770"></a>35770</td>
<td class="instruction">ADD IX,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35772"></a>35772</td>
<td class="instruction">LD BC,64510</td>
<td class="comment-11" rowspan="2">Read keys Q-W-E-R-T</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35775"></a>35775</td>
<td class="instruction">IN A,(C)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35777"></a>35777</td>
<td class="instruction">AND 31</td>
<td class="comment-11" rowspan="1">Keep only bits 0-5</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35779"></a>35779</td>
<td class="instruction">CP (IX+0)</td>
<td class="comment-11" rowspan="1">Does this match the first byte of the entry in the WRITETYPER table?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35782"></a>35782</td>
<td class="instruction">JR Z,<a class="link" href="35591.html#35802">35802</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35784"></a>35784</td>
<td class="instruction">CP 31</td>
<td class="comment-11" rowspan="1">Are any of the keys Q-W-E-R-T being pressed?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35786"></a>35786</td>
<td class="instruction">JP Z,<a class="link" href="35245.html">35245</a></td>
<td class="comment-11" rowspan="1">If not, jump back to the start of the main loop</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35789"></a>35789</td>
<td class="instruction">CP (IX-2)</td>
<td class="comment-11" rowspan="1">Does the keyboard reading match the first byte of the previous entry in the WRITETYPER table?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35792"></a>35792</td>
<td class="instruction">JP Z,<a class="link" href="35245.html">35245</a></td>
<td class="comment-11" rowspan="1">If so, jump back to the start of the main loop</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35795"></a>35795</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="2">Reset the WRITETYPER key counter at <a class="link" href="34275.html">34275</a> to 0 (an incorrect key was pressed)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35796"></a>35796</td>
<td class="instruction">LD (34275),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35799"></a>35799</td>
<td class="instruction">JP <a class="link" href="35245.html">35245</a></td>
<td class="comment-11" rowspan="1">Jump back to the start of the main loop</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="35802"></a>35802</td>
<td class="instruction">LD B,223</td>
<td class="comment-11" rowspan="2">Read keys Y-U-I-O-P</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35804"></a>35804</td>
<td class="instruction">IN A,(C)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35806"></a>35806</td>
<td class="instruction">AND 31</td>
<td class="comment-11" rowspan="1">Keep only bits 0-5</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35808"></a>35808</td>
<td class="instruction">CP (IX+1)</td>
<td class="comment-11" rowspan="1">Does this match the second byte of the entry in the WRITETYPER table?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35811"></a>35811</td>
<td class="instruction">JR Z,<a class="link" href="35591.html#35831">35831</a></td>
<td class="comment-11" rowspan="1">If so, jump to increment the WRITETYPER key counter</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35813"></a>35813</td>
<td class="instruction">CP 31</td>
<td class="comment-11" rowspan="1">Are any of the keys Y-U-I-O-P being pressed?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35815"></a>35815</td>
<td class="instruction">JP Z,<a class="link" href="35245.html">35245</a></td>
<td class="comment-11" rowspan="1">If not, jump back to the start of the main loop</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35818"></a>35818</td>
<td class="instruction">CP (IX-1)</td>
<td class="comment-11" rowspan="1">Does the keyboard reading match the second byte of the previous entry in the WRITETYPER table?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35821"></a>35821</td>
<td class="instruction">JP Z,<a class="link" href="35245.html">35245</a></td>
<td class="comment-11" rowspan="1">If so, jump back to the start of the main loop</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35824"></a>35824</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="2">Reset the WRITETYPER key counter at <a class="link" href="34275.html">34275</a> to 0 (an incorrect key was pressed)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35825"></a>35825</td>
<td class="instruction">LD (34275),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35828"></a>35828</td>
<td class="instruction">JP <a class="link" href="35245.html">35245</a></td>
<td class="comment-11" rowspan="1">Jump back to the start of the main loop</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="35831"></a>35831</td>
<td class="instruction">LD A,(34275)</td>
<td class="comment-11" rowspan="3">Increment the WRITETYPER key counter at <a class="link" href="34275.html">34275</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35834"></a>35834</td>
<td class="instruction">INC A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35835"></a>35835</td>
<td class="instruction">LD (34275),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35838"></a>35838</td>
<td class="instruction">JP <a class="link" href="35245.html">35245</a></td>
<td class="comment-11" rowspan="1">Jump back to the start of the main loop</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="35563.html">35563</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#35591">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="35841.html">35841</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Jet Set Willy RAM disassembly 20141114</div>
<div class="copyright">&#169; 1984 Software Projects Ltd (Jet Set Willy). &#169; 2014 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.1.1.</div>
</div>
</body>
</html>