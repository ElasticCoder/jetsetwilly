<!DOCTYPE html>
<html>
<head>
<title>Jet Set Willy: Bugs</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Bugs">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Jet Set Willy" src="../images/logo.png" /></a></td>
<td class="page-header">Bugs</td>
</tr>
</table>
<ul class="contents">
<li><a href="#faultyClock">12:30am in the afternoon</a></li>
<li><a href="#theStickyBed">The sticky bed</a></li>
<li><a href="#selfCollectingItem">The self-collecting item</a></li>
<li><a href="#theInvisibleItem">The invisible item</a></li>
<li><a href="#theInaccessibleItems">The inaccessible items</a></li>
<li><a href="#theUncollectableItem">The uncollectable item</a></li>
<li><a href="#dontMindYourHead">Don't mind your head</a></li>
<li><a href="#theBlankConveyor">The blank conveyor</a></li>
<li><a href="#corruptedConveyors">Corrupted conveyors</a></li>
<li><a href="#invalidGridLocation">Invalid grid location</a></li>
<li><a href="#thePauseBug">The pause bug</a></li>
<li><a href="#theAtticBug">The Attic bug</a></li>
</ul>
<div><span id="faultyClock"></span></div>
<div class="box box-1">
<div class="box-title">12:30am in the afternoon</div>
<div class="paragraph">
The clock-updating code at <a href="../asm/89AD.html#8a52">8A52</a> doesn't switch from 'am' to 'pm' until 1pm (instead of 12 noon), and also doesn't switch from 'pm' to 'am' at midnight.
</div>
</div>
<div><span id="theStickyBed"></span></div>
<div class="box box-2">
<div class="box-title">The sticky bed</div>
<div class="paragraph">
After collecting all the items, if Willy jumps onto the bed in <a href="../asm/E300.html">Master Bedroom</a> (which is a conveyor moving right) instead of walking up to the foot of it, he will stop moving and the 'P' (right) key becomes unresponsive. This happens because the code at <a href="../asm/8ED4.html#8f0b">8F0B</a> flips bit 0 of <span class="register">E</span> - which has already been reset because Willy is on a conveyor moving right - to 1, thus preventing the conveyor from moving Willy, and also effectively disabling the 'P' key.
</div>
<div class="paragraph">
To see this, use POKE <a href="../asm/A3FF.html">41983</a>,255 to make the tap in <a href="../asm/E100.html">The Bathroom</a> the only item that needs to be collected to complete the game, make your way to the bedroom, and jump onto the bed.
</div>
<div class="paragraph">
However, all is not lost. Willy can be moved off the bed by using one of the other 'right' keys: 'I', 'Y', 'R', 'W', '7' or '8'.
</div>
</div>
<div><span id="selfCollectingItem"></span></div>
<div class="box box-1">
<div class="box-title">The self-collecting item</div>
<div class="paragraph">
The item in <a href="../asm/DF00.html">Swimming Pool</a> is automatically collected as soon as Willy enters the room; this is because the room's background tile has white INK, and the routine at <a href="../asm/93D1.html">93D1</a> collects any item that is drawn on a cell with white INK. There are no other rooms whose background tile has white INK.
</div>
<div class="paragraph">
To change the INK of the room's background tile from white to cyan, enabling Willy to collect the item himself:
</div>
<div class="paragraph">
POKE <a href="../asm/DF00.html#dfa0">57248</a>,5
</div>
<div class="paragraph">
Note that this changes the rope's colour from white to cyan.
</div>
</div>
<div><span id="theInvisibleItem"></span></div>
<div class="box box-2">
<div class="box-title">The invisible item</div>
<div class="paragraph">
There is an item in <a href="../asm/DC00.html">First Landing</a>, but you could be forgiven for not knowing because it's invisible. To give the item a shape and make it visible:
</div>
<div class="paragraph">
POKE 56548,24: POKE 56549,24
</div>
<div class="paragraph">
But now that the item is revealed, we can also see that it's unreachable:
</div>
<div class="paragraph">
<img alt="first_landing_item1" src="../images/scr/first_landing_item1.gif" />
</div>
<div class="paragraph">
To add a ledge and open the wall to make the item reachable:
</div>
<div class="paragraph">
POKE 56350,0: POKE 56358,0: POKE 56365,170
</div>
<div class="paragraph">
<img alt="first_landing_item2" src="../images/scr/first_landing_item2.gif" />
</div>
<div class="paragraph">
The <a href="pokes.html#theOfficialSoftwareProjectsPOKEs">official Software Projects POKE</a> to fix this bug is
</div>
<div class="paragraph">
POKE <a href="../asm/A400.html#a4c7">42183</a>,11
</div>
<div class="paragraph">
which moves the item to <a href="../asm/CB00.html">The Hall</a> (where it is still invisible, but now reachable).
</div>
</div>
<div><span id="theInaccessibleItems"></span></div>
<div class="box box-1">
<div class="box-title">The inaccessible items</div>
<div class="paragraph">
The items in <a href="../asm/EB00.html">Conservatory Roof</a> can only be collected by entering the room from the ledge on the lower left in <a href="../asm/EA00.html">Under the Roof</a>, but that ledge is unreachable.
</div>
<div class="paragraph">
The <a href="pokes.html#theOfficialSoftwareProjectsPOKEs">official Software Projects POKE</a> to fix this bug is
</div>
<div class="paragraph">
POKE <a href="../asm/DE00.html">56876</a>,4
</div>
<div class="paragraph">
which makes it possible to access the right-hand side of <a href="../asm/E400.html">A bit of tree</a> (and from there the lower right side in <a href="../asm/EA00.html">Under the Roof</a>) from <a href="../asm/DE00.html">The Banyan Tree</a>.
</div>
</div>
<div><span id="theUncollectableItem"></span></div>
<div class="box box-2">
<div class="box-title">The uncollectable item</div>
<div class="paragraph">
The item on the far right in <a href="../asm/EB00.html">Conservatory Roof</a> cannot be collected because there is an unavoidable nasty in the way.
</div>
<div class="paragraph">
The <a href="pokes.html#theOfficialSoftwareProjectsPOKEs">official Software Projects POKE</a> to fix this bug is
</div>
<div class="paragraph">
POKE <a href="../asm/EB00.html#eb00">60231</a>,0
</div>
<div class="paragraph">
which removes the nasty next to the item.
</div>
</div>
<div><span id="dontMindYourHead"></span></div>
<div class="box box-1">
<div class="box-title">Don't mind your head</div>
<div class="paragraph">
The code at <a href="../asm/8FBC.html#8fdc">8FDC</a> onwards that moves Willy left does not check for a wall tile at head height, which means Willy can move right to left through a wall tile at that position. To see this, add a wall tile at head height in <a href="../asm/E100.html">The Bathroom</a> and guide Willy through it:
</div>
<div class="paragraph">
POKE 57708,32
</div>
<div class="paragraph">
However, the code at <a href="../asm/8FBC.html#904e">904E</a> onwards that moves Willy right does check for a wall tile at head height (at <a href="../asm/8FBC.html#90a7">90A7</a>), so Willy (correctly) cannot move left to right through a wall tile at that position.
</div>
</div>
<div><span id="theBlankConveyor"></span></div>
<div class="box box-2">
<div class="box-title">The blank conveyor</div>
<div class="paragraph">
The conveyor tile in <a href="../asm/EB00.html">Conservatory Roof</a> is completely blank and its attribute byte is 255 - a solid, bright white block - which is characteristic of unused tiles elsewhere. However, the conveyor tile <em>is</em> used in this room, and it doesn't look good:
</div>
<div class="paragraph">
<table class="">
<tr>
<td class="" colspan="1" rowspan="1"><img alt="blank_conveyor" src="../images/scr/blank_conveyor.png" /></td>
</tr>
</table>
</div>
</div>
<div><span id="corruptedConveyors"></span></div>
<div class="box box-1">
<div class="box-title">Corrupted conveyors</div>
<div class="paragraph">
The conveyors in <a href="../asm/D800.html">West of Kitchen</a>, <a href="../asm/DD00.html">The Nightmare Room</a>, <a href="../asm/F100.html">The Wine Cellar</a> and <a href="../asm/F300.html">Tool&#160;&#160;Shed</a> don't look quite as they should. The reason for this is a bug in the code at <a href="../asm/8D33.html#8d51">8D51</a>: if a graphic data byte of the background, floor, wall, nasty or ramp tile in a room matches the attribute byte of the conveyor tile to be drawn, the CPIR instruction exits early, leaving <span class="register">HL</span> pointing at the wrong location.
</div>
<div class="paragraph">
Here are some 'before' and 'after' pictures showing what the conveyors actually look like and what they should look like.
</div>
<div class="paragraph">
<table class="gallery">
<tr>
<td class="" colspan="1" rowspan="1"><a href="../asm/D800.html">West of Kitchen</a></td>
<td class="" colspan="1" rowspan="1"><img alt="conveyor24_before" src="../images/scr/conveyor24_before.gif" /></td>
<td class="" colspan="1" rowspan="1"><img alt="conveyor24_after" src="../images/scr/conveyor24_after.gif" /></td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1"><a href="../asm/DD00.html">The Nightmare Room</a></td>
<td class="" colspan="1" rowspan="1"><img alt="conveyor29_before" src="../images/scr/conveyor29_before.gif" /></td>
<td class="" colspan="1" rowspan="1"><img alt="conveyor29_after" src="../images/scr/conveyor29_after.gif" /></td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1"><a href="../asm/F100.html">The Wine Cellar</a></td>
<td class="" colspan="1" rowspan="1"><img alt="conveyor49_before" src="../images/scr/conveyor49_before.gif" /></td>
<td class="" colspan="1" rowspan="1"><img alt="conveyor49_after" src="../images/scr/conveyor49_after.png" /></td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1"><a href="../asm/F300.html">Tool&#160;&#160;Shed</a></td>
<td class="" colspan="1" rowspan="1"><img alt="conveyor51_before" src="../images/scr/conveyor51_before.gif" /></td>
<td class="" colspan="1" rowspan="1"><img alt="conveyor51_after" src="../images/scr/conveyor51_after.gif" /></td>
</tr>
<tr>
<td class="transparent" colspan="1" rowspan="1"></td>
<td class="" colspan="1" rowspan="1">Before</td>
<td class="" colspan="1" rowspan="1">After</td>
</tr>
</table>
</div>
<div class="paragraph">
To fix the bug:
</div>
<div class="paragraph">
<div>POKE 36178,151</div>
<div>POKE 36181,9</div>
<div>POKE 36183,205</div>
<div>POKE 36184,38</div>
<div>POKE 36185,255</div>
<div>POKE 65318,9</div>
<div>POKE 65319,190</div>
<div>POKE 65322,75</div>
<div>POKE 65323,35</div>
<div>POKE 65324,201</div>
</div>
</div>
<div><span id="invalidGridLocation"></span></div>
<div class="box box-2">
<div class="box-title">Invalid grid location</div>
<div class="paragraph">
If the LSB of the system variable FRAMES (at 23672) is 142 when the game starts, the routine at <a href="../asm/86C3.html">86C3</a> will ask for the code at the grid location 'D>', which doesn't exist on the code sheet.
</div>
<div class="paragraph">
Should you ever need it, the code for 'D>' is 1444.
</div>
<div class="paragraph">
POKE <a href="../asm/86C3.html#86fb">34556</a>,180
</div>
</div>
<div><span id="thePauseBug"></span></div>
<div class="box box-1">
<div class="box-title">The pause bug</div>
<div class="paragraph">
The Spectrum will hang when trying to resume the game after being paused if an Interface 1 is connected. This happens because the <span class="register">C</span> register holds 0 instead of 254 when the keyboard is read by the IN A,(C) instruction at <a href="../asm/8B07.html#8b24">8B24</a>.
</div>
<div class="paragraph">
POKE <a href="../asm/8B07.html#8b1f">35615</a>,62: POKE <a href="../asm/8B07.html#8b24">35620</a>,219: POKE <a href="../asm/8B07.html#8b24">35621</a>,254
</div>
</div>
<div><span id="theAtticBug"></span></div>
<div class="box box-2">
<div class="box-title">The Attic bug</div>
<div class="paragraph">
Perhaps the most famous of all the bugs in Jet Set Willy, the Attic bug is responsible for certain rooms becoming impossible to navigate after Willy has visited <a href="../asm/E900.html">The Attic</a>, thus making it impossible to complete the game.
</div>
<div class="paragraph">
The root cause of the bug is a misplaced arrow, defined by the entity specification at <a href="../asm/E900.html#e9fc">E9FC</a>. The second byte of the entity specification is an index into the table of screen buffer addresses at <a href="../asm/8200.html">8200</a>, and determines the arrow's y-coordinate; the index should be an even number, but the value of the second byte is 213, which means the arrow-drawing routine at <a href="../asm/91BE.html">91BE</a> looks up the word at 33493 (33280+213) and finds 41066, way outside the actual screen buffer at 24576-28671. As a result, the misplaced arrow is 'drawn' at the following addresses:
</div>
<div class="paragraph">
<ul>
<li><a href="../asm/9EB3.html#9f00">40810-40841</a>: unused (set to 65, with no effect on the game)</li>
<li><a href="../asm/A000.html#a068">41066-41097</a>: the third byte of entity definition 13 through to the second byte of entity definition 17 (set to 255); this affects the guardians in <a href="../asm/CE00.html">Rescue Esmerelda</a>, <a href="../asm/CF00.html">I'm sure I've seen this before..</a>, <a href="../asm/D000.html">We must perform a Quirkafleeg</a>, <a href="../asm/C100.html">The Bridge</a>, <a href="../asm/C600.html">Entrance to Hades</a>, <a href="../asm/DB00.html">The Chapel</a> and <a href="../asm/E600.html">Priests' Hole</a></li>
<li><a href="../asm/A000.html#a168">41322-41353</a>: the third byte of entity definition 45 through to the second byte of entity definition 49 (set to 65); this affects the guardians in <a href="../asm/CD00.html">Out on a limb</a>, <a href="../asm/DA00.html">East Wall Base</a>, <a href="../asm/CC00.html">Tree Top</a>, <a href="../asm/C800.html">Inside the MegaTrunk</a>, <a href="../asm/D700.html">The Kitchen</a> and <a href="../asm/D800.html">West of Kitchen</a></li>
</ul>
</div>
<div class="paragraph">
The <a href="pokes.html#theOfficialSoftwareProjectsPOKEs">official Software Projects POKE</a> to fix the Attic bug is
</div>
<div class="paragraph">
POKE <a href="../asm/E900.html#e9fc">59901</a>,82
</div>
<div class="paragraph">
which sets the pixel y-coordinate of the arrow to 41.
</div>
</div>
<footer>
<div class="release">The complete Jet Set Willy RAM disassembly 20160117</div>
<div class="copyright">&#169; 1984 Software Projects Ltd (Jet Set Willy). &#169; 2016 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a href="http://skoolkit.ca/">SkoolKit</a> 5.1.</div>
</footer>
</body>
</html>